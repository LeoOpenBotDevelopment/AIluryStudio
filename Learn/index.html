<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIlury Learn</title>
    <style>
        :root {
            --bbg-color: #E9E9EF;
            --bg-color: #fff;
            --pbg-color: #D9D9D9;
            --text-color: #000;
            --accent-color: #8C52FF;
            --progress-bar-fill1: #8C52FF;
            --progress-bar-fill2: #CB6CE6;
            --progress-bar-fill3: #FF66C4;
            --progress-bar-fill4: #FF5757;
            --green-color1: #00BF63;
            --green-color2: #7ED957;
            --orange-color1: #FFBD59;
            --orange-color2: #FFDE59;
            --red-color1: #FF3131;
            --red-color2: #FF6D4D;
            --default-fbg-color: #fcfcfc;
            --default-bbg-color: #cfcfcf;
            --font-size: 1.3em;
            --sidebar-width: 25vw;
            --chat-sidebar-width: 25vw;
        }
        
        * {
            box-sizing: border-box;
        }
        body, #content-container {
            margin: 0;
            padding: 0;
            background-color: var(--bbg-color);
            color: var(--text-color);
            font-size: 20px;
            height: 100dvh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
        }
        @keyframes progressBarAnimation {
            from {
                margin-top: -100px;
            }
            to {
                margin-top: 0;
            }
        }
        @keyframes progressBarAnimationOut {
            from {
                margin-top: 0;
            }
            to {
                margin-top: -100px;
            }
        }
        #progress-bar-bar-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
        }
        #progress-bar-container {
            padding: 20px;
            border: none;
            border-radius: 30px;
            background-color: var(--bg-color);
            display: none;
            margin-top: -100px;
            transition: 0.3s;
            border-bottom-right-radius: 10px;
            border-bottom-left-radius: 10px;
        }
        #progress-bar {
            width: 100%;
            height: 10px;
            border-radius: 10px;
            background-color: var(--pbg-color);
            display: flex;
            align-items: left;
            padding: 0;
            margin: 0;
            position: relative;
            align-items: center;
            justify-content: center;
        }
        .progress-bar-fill {
            height: 10px;
            border-radius: 10px;
            margin: 0;
            transition: 0.3s;
            position: absolute;
            left: 0;
            top: 0;
        }
        #Fill1 {
            background-color: var(--progress-bar-fill1);
            width: 0%;
            z-index: 4;
        }
        #Fill2 {
            background-color: var(--progress-bar-fill2);
            width: 0%;
            z-index: 3;
        }
        #Fill3 {
            background-color: var(--progress-bar-fill3);
            width: 0%;
            z-index: 2;
        }
        #Fill4 {
            background-color: var(--progress-bar-fill4);
            width: 0%;
            z-index: 1;
        }
        .section {
          height: 100dvh;
          width: 100vw;
          display: none;
          flex-direction: column;
          overflow: hidden;
          max-width: 1000px;
        }
        .sidebarEnabled .section {
            max-width: calc(100vw - var(--sidebar-width));
        }
        #learncontainer {
            display: flex;
        }
        #content, .sec-content {
            margin: 0;
            margin-top: 5px;
            flex: 1;
            background-color: var(--bg-color);
            border-radius: 10px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 20px;
            display: flex;
            align-items: left;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }
        .content {
            display: none;
            padding: 20px;
            overflow-y: auto;
            transition: 0.3s;
            /*flex-direction: column;*/
            position: relative;
            width: 100%;
            height: 100%;
        }
        .section > .content {
            display: flex;
        }
        @keyframes buttonAnimation {
            from {
                opacity: 0;
                transform: translateY(-20px);
                box-shadow: 0px 20px 50px rgba(0, 0, 0, 0.3);
            }
            to {
                opacity: 1;
                transform: translateY(0);
                box-shadow: none;
            }
        }
        @keyframes easeinlefttoright {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes easeinbottomtotop {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .content button:not(.audio-button) {
            background-color: var(--bg-color);
            font-size: 3em;
            color: var(--bg-color);
            font-weight: bold;
            border: none;
            border-radius: 7px;
            text-align: center;
            margin: 0;
            margin-top: 7px;
            padding: 20px;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            width: 100%;
            text-shadow: 
                -2px -2px 0 var(--text-color),  
                 2px -2px 0 var(--text-color),
                -2px  2px 0 var(--text-color),
                 2px  2px 0 var(--text-color);
            background-position: 0;
            background-size: 100%;
            width: 100%;
            animation: buttonAnimation 2s ease;
        }
        .content p {
            font-size: var(--font-size);
        }
        #choose-content {
            display: flex;
            flex-direction: column;
            flex: 1;
        }
        @keyframes easein {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        #loading {
            height: 100%;
            width: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            display: none;
            justify-content: center;
            align-items: center;
            position: absolute;
            top: 0;
            left: 0;
            animation: easein 0.3s ease-in;
            z-index: 1000;
        }
        @keyframes loading {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        #spinner {
            border: 5px solid rgba(0, 0, 0, 0.3);
            border-left: 5px solid white;
            background: transparent;
            height: 60px;
            width: 60px;
            animation: loading 0.7s ease-in-out infinite;
            border-radius: 50%;
        }
        @keyframes optionAnimation {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .optionBtn {
            width: 100%;
            font-weight: bold;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            font-size: 1.5em;
            background-color: var(--bg-color);
            border-radius: 10px;
            display: flex;
            margin-top: 7px;
            
            position: relative;
            padding: 15px;
            color: transparent;
            animation: optionAnimation 0.5s ease;
        }
        .optionFill {
            height: 100%;
            width: 0px;
            border-radius: 10px;
            transition: 0.5s;
            padding: 15px;
            top: 0;
            left: 0;
            position: absolute;
            color: transparent;
        }
        .optionTitle {
            position: relative;
            color: var(--text-color);
            height: 100%;
            width: 100%;
        }
        .location {
            height: 30px;
            width: 30px;
            border-radius: 20px;
            border-bottom-right-radius: 0;
            background-color: var(--accent-color);
            transform: rotate(45deg);
            position: absolute;
            left: 0;
            bottom: 0;
            z-index: 50;
            box-shadow: 15px 15px 20px rgba(0, 0, 0, 0.5);
            border: 2px solid var(--text-color);
            transition: 0.5s;
        }
        .NumberGrid {
            width: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(10, 1fr);
            gap: 2px;
            margin-top: 10px;
            animation: buttonAnimation 2s ease;
        }
        .gridNumber {
            height: 100%;
            width: 100%;
            background-color: var(--bbg-color);
            border: none;
            border-radius: 2px;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            font-size: 0.7em;
            transition: 0.3s;
        }
        .green1 {
            background-color: var(--green-color1);
        }
        .orange1 {
            background-color: var(--orange-color1);
        }
        .red1 {
            background-color: var(--red-color1);
        }
        .green2 {
            background-color: var(--green-color2);
        }
        .orange2 {
            background-color: var(--orange-color2);
        }
        .red2 {
            background-color: var(--red-color2);
        }
        #timer-container {
            margin: 10px;
            padding: 10px;
            position: absolute;
            right: 15px;
            top: 0;
            display: none;
        }
        #icon {
            color: var(--text-color);
            font-size: 1.5em;
            background: transparent;
            border: none;
            padding: 5px;
        }
        #time {
            color: var(--text-color);
            font-size: 1.1em;
            background: transparent;
            border: none;
            padding: 5px;
            font-weight: bold;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
        }
        #learn-content {
            padding-top: 60px;
            max-width: 700px;
            width: 100%;
        }
        .learnOp {
            padding: 10px;
            font-size: 1.1em;
            color: var(--text-color);
            border: none;
            border-radius: 10px;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            position: absolute;
            display: none;
            animation: buttonAnimation 1.5s ease;
            background-color: var(--bbg-color);
        }
        #backBtn {
            top: 15px;
            left: 15px;
        }
        #skipBtn {
            top: 15px;
            right: 15px;
        }
        @keyframes pointAnimation {
            30% {
                text-shadow: 0px 0px 10px var(--progress-bar-fill1);
                transform: rotate(10deg) scale(1.2);
                color: var(--progress-bar-fill1);
            }
            60% {
                text-shadow: 0px 0px 10px var(--progress-bar-fill1);
                transform: rotate(-10deg) scale(1.2);
                color: var(--progress-bar-fill1);
            }
        }
        #points {
            margin-left: 5px;
        }
        #pointsIcon {
            color: var(--accent-color);
        }
        #pointsContainer {
            margin-left: 15px;
            display: flex;
            animation: pointAnimation 2s ease;
        }
        #sidebar {
            margin: 0;
            width: var(--sidebar-width);
            height: 100%;
            display: none;
            position: relative;
        }
        .sidebarEnabled #sidebar {
            display: block;
        }
        #sidebar-button-container {
            padding: 7px;
        }
        #sidebar button{
            padding: 15px;
            padding-left: 20px;
            font-size: 1.2em;
            color: var(--text-color);
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            width: 100%;
            border: none;
            border-radius: 10px;
            text-align: left;
            margin-top: 15px;
            transition: 0.3s;
            background-color: var(--bbg-color);
        }
        #sidebar button.Active {
            background-color: var(--bg-color);
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
            color: var(--accent-color);
            position: relative;
        }
        .sidebarEnabled #sidebar button.Active {
            width: calc(100% + 7px);
        }
        .sidebarEnabled #sidebar button.Active:after {
            content: "";
            position: absolute;
            height: 30px;
            width: 30px;
            top: -30px;
            right: 0;
            background-color: transparent;
            border-radius: 10px;
            border-top-right-radius: 0;
            border-bottom-left-radius: 0;
            box-shadow: 5px 5px 0px var(--bg-color);
        }
        .sidebarEnabled #sidebar button.Active:before {
            content: "";
            position: absolute;
            height: 30px;
            width: 30px;
            bottom: -30px;
            right: 0;
            background-color: transparent;
            border-radius: 10px;
            border-bottom-right-radius: 0;
            border-top-left-radius: 0;
            box-shadow: 5px -5px 0px var(--bg-color);
        }
        #profile {
            width: 100%;
            border-bottom: 2px solid var(--bg-color);
            padding: 10px;
            display: flex;
        }
        #profilePicContainer {
            height: 100px;
            width: 100px;
            border-radius: 50%;
            display: flex;
            overflow: hidden;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
        }
        #profilePic {
            height: 100px;
            width: 100px;
            border-radius: 3px;
            background-color: var(--bg-color);
            object-fit: cover;
            scroll-snap-align: start;
            margin-right: 5px;
        }
        #userName {
            font-weight: bold;
            font-size: 1.3em;
            color: var(--text-color);
            padding: 0;
            margin: 0;
        }
        #extraUserInfo {
            padding: 0;
            margin: 0;
            margin-top: 5px;
        }
        #profileInfo {
            margin-left: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        #chat-container {
            padding: 15px;
            justify-content: space-between;
        }
        #chat-sidebar {
            width: var(--chat-sidebar-width);
            height: 100%;
            border-radius: 20px;
            background-color: var(--bbg-color);
            display: none;
            flex-direction: column;
            animation: easeinlefttoright 1s ease;
        }
        .chatSidebarEnabled #chat-sidebar {
            display: flex;
        }
        #chat-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }
        #emptyChatText {
            flex: 1;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 1.6em;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
        }
        #message-form {
            display: flex;
            border: none;
            margin-left: 15px;
            animation: easeinbottomtotop 1s ease;
        }
        #message-form button {
            padding: 10px;
            background: var(--bbg-color);
            border: none;
            border-radius: 15px;
            margin-left: 1px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            color: var(--accent-color);
            font-size: 0.8em;
            font-weight: bold;
        }
        #message-form textarea {
            color: var(--text-color);
            background: var(--bbg-color);
            border: none;
            border-radius: 0;
            font-size: 1em;
            padding: 13px;
            box-sizing: border-box;
            width: 100%;
            display: flex;
            flex: 1;
            resize: none;
            overflow: hidden;
            min-height: 40px;
            max-height: 40dvh;
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
            overflow-y: auto;
        }
        input[type="text"] {
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            background-color: var(--bg-color);
            padding: 15px;
            margin: 5px;
            animation: buttonAnimation 1s ease;
        }
        input[type="text"]:focus, textarea:focus {
            outline: none;
        }
        ::placeholder {
            color: var(--text-color);
            opacity: 0.4;
        }
        #chat-messages {
            height: 100%;
            width: 100%;
        }
        #chat-sidebar h2 {
            padding: 20px;
            font-size: 1.2em;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            border-bottom: 2px solid var(--bg-color);
            margin: 0;
        }
        .cursorElement {
            color: var(--accent-color);
        }
        #server-container {
            width: 100%;
            height: 100%;
            overflow: hidden;
            overflow-y: auto;
        }
        .resizesidebarbar {
            position: absolute;
            right: -10px;
            top: 0;
            background: transparent;
            height: 100dvh;
            width: 50px;
            z-index: 6;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            font-size: 1.7em;
            color: var(--bg-color);
            transform: scaleX(0.4);
            cursor: ew-resize;
            font-family: "Arial Rounded MT Bold", "Arial", sans-serif;
            transition: backgroundColor 0.3s;
        }
        #continentsMapContainer, #europeMapContainer, #northAmericaMapContainer, #africaMapContainer {
            width: 100%;
            overflow: hidden;
            position: relative;
            animation: buttonAnimation 2s ease;
            border-radius: 15px;
        }
        #continentsMapContainer img, #europeMapContainer img, #northAmericaMapContainer img, #africaMapContainer img {
            object-fit: cover;
            height: 100%;
            width: 100%;
        }
        #continentsMapContainer #asia {
            position: absolute;
            bottom: 78%;
            left: 60%;
        }
        #continentsMapContainer #africa {
            position: absolute;
            bottom: 52%;
            left: 44%;
        }
        #continentsMapContainer #europe {
            position: absolute;
            bottom: 84%;
            left: 46%;
        }
        #continentsMapContainer #northamerica {
            position: absolute;
            bottom: 82%;
            left: 11%;
        }
        #continentsMapContainer #southamerica {
            position: absolute;
            bottom: 36%;
            left: 20%;
        }
        #continentsMapContainer #australia {
            position: absolute;
            bottom: 31%;
            left: 76%;
        }
        #continentsMapContainer #antarctica {
            position: absolute;
            bottom: 6%;
            left: 50%;
        }
        /* europe */
        #europeMapContainer .location {
            height: 15px;
            width: 15px;
        }
        #europeMapContainer #iceland {
            position: absolute;
            bottom: 84%;
            left: 8%;
        }
        #europeMapContainer #ireland {
            position: absolute;
            bottom: 54%;
            left: 18%;
        }
        #europeMapContainer #unitedkingdom {
            position: absolute;
            bottom: 56%;
            left: 27%;
        }
        #europeMapContainer #norway {
            position: absolute;
            bottom: 75%;
            left: 45%;
        }
        #europeMapContainer #sweden {
            position: absolute;
            bottom: 78%;
            left: 54%;
        }
        #europeMapContainer #finland {
            position: absolute;
            bottom: 80%;
            left: 69%;
        }
        #europeMapContainer #estonia {
            position: absolute;
            bottom: 69%;
            left: 69%;
        }
        #europeMapContainer #livia {
            position: absolute;
            bottom: 65%;
            left: 68%;
        }
        #europeMapContainer #lithuania {
            position: absolute;
            bottom: 60%;
            left: 67%;
        }
        #europeMapContainer #belarus {
            position: absolute;
            bottom: 56%;
            left: 73%;
        }
        #europeMapContainer #ukraine {
            position: absolute;
            bottom: 45%;
            left: 78%;
        }
        #europeMapContainer #russia {
            position: absolute;
            bottom: 68%;
            left: 85%;
        }
        #europeMapContainer #slovakia {
            position: absolute;
            bottom: 43%;
            left: 60%;
        }
        #europeMapContainer #moldova {
            position: absolute;
            bottom: 39%;
            left: 74%;
        }
        #europeMapContainer #romania {
            position: absolute;
            bottom: 35%;
            left: 68%;
        }
        #europeMapContainer #bulgaria {
            position: absolute;
            bottom: 26%;
            left: 69%;
        }
        #europeMapContainer #germany {
            position: absolute;
            bottom: 50%;
            left: 45%;
        }
        #europeMapContainer #poland {
            position: absolute;
            bottom: 52%;
            left: 60%;
        }
        #europeMapContainer #netherlands {
            position: absolute;
            bottom: 52%;
            left: 38%;
        }
        #europeMapContainer #belgium {
            position: absolute;
            bottom: 48%;
            left: 37%;
        }
        #europeMapContainer #luxemburg {
            position: absolute;
            bottom: 45.5%;
            left: 39%;
        }
        #europeMapContainer #france {
            position: absolute;
            bottom: 38%;
            left: 32%;
        }
        #europeMapContainer #sweetzerland {
            position: absolute;
            bottom: 38%;
            left: 42%;
        }
        #europeMapContainer #italy {
            position: absolute;
            bottom: 27%;
            left: 48%;
        }
        #europeMapContainer #spain {
            position: absolute;
            bottom: 20%;
            left: 22%;
        }
        #europeMapContainer #portugal {
            position: absolute;
            bottom: 18%;
            left: 14%;
        }
        #europeMapContainer #georgia {
            position: absolute;
            bottom: 25%;
            left: 98%;
        }
        #europeMapContainer #turkey {
            position: absolute;
            bottom: 18%;
            left: 86%;
        }
        #europeMapContainer #cyprus {
            position: absolute;
            bottom: 5.5%;
            left: 83.5%;
        }
        #europeMapContainer #greece {
            position: absolute;
            bottom: 17%;
            left: 64%;
        }
        #europeMapContainer #albania {
            position: absolute;
            bottom: 23%;
            left: 61%;
        }
        #europeMapContainer #macedonia {
            position: absolute;
            bottom: 24%;
            left: 63.5%;
        }
        #europeMapContainer #serbia {
            position: absolute;
            bottom: 30%;
            left: 62%;
        }
        #europeMapContainer #slovania {
            position: absolute;
            bottom: 35.5%;
            left: 52%;
        }
        #europeMapContainer #croatia {
            position: absolute;
            bottom: 34%;
            left: 55%;
        }
        #europeMapContainer #bosnia {
            position: absolute;
            bottom: 31%;
            left: 57%;
        }
        #europeMapContainer #hungary {
            position: absolute;
            bottom: 38%;
            left: 60%;
        }
        #europeMapContainer #czechrepublic {
            position: absolute;
            bottom: 46%;
            left: 53%;
        }
        #europeMapContainer #austria {
            position: absolute;
            bottom: 40%;
            left: 52%;
        }
        #europeMapContainer #denmark {
            position: absolute;
            bottom: 62%;
            left: 45%;
        }
        #europeMapContainer #montenegro {
            position: absolute;
            bottom: 27%;
            left: 59.5%;
        }
        /* north america */
        #northAmericaMapContainer .location {
            height: 20px;
            width: 20px;
        }
        #northAmericaMapContainer #greenland {
            position: absolute;
            bottom: 85%;
            left: 70%;
        }
        #northAmericaMapContainer #unitedstatesofamerica {
            position: absolute;
            bottom: 39%;
            left: 45%;
        }
        #northAmericaMapContainer #unitedstatesofamerica2 {
            position: absolute;
            bottom: 75%;
            left: 17%;
        }
        #northAmericaMapContainer #canada {
            position: absolute;
            bottom: 64%;
            left: 43%;
        }
        #northAmericaMapContainer #mexico {
            position: absolute;
            bottom: 20%;
            left: 40%;
        }
        #northAmericaMapContainer #guatemala {
            position: absolute;
            bottom: 11%;
            left: 53%;
        }
        #northAmericaMapContainer #belize {
            position: absolute;
            bottom: 14%;
            left: 56.5%;
        }
        #northAmericaMapContainer #elsalvador {
            position: absolute;
            bottom: 10%;
            left: 57%;
        }
        #northAmericaMapContainer #honduras {
            position: absolute;
            bottom: 12%;
            left: 60%;
        }
        #northAmericaMapContainer #nicaragua {
            position: absolute;
            bottom: 9%;
            left: 62%;
        }
        #northAmericaMapContainer #costarica {
            position: absolute;
            bottom: 6%;
            left: 64%;
        }
        #northAmericaMapContainer #panama {
            position: absolute;
            bottom: 4.5%;
            left: 68%;
        }
        #northAmericaMapContainer #cuba {
            position: absolute;
            bottom: 21%;
            left: 69%;
        }
        #northAmericaMapContainer #jamaica {
            position: absolute;
            bottom: 17%;
            left: 70.5%;
        }
        #northAmericaMapContainer #puertorico {
            position: absolute;
            bottom: 20.5%;
            left: 84%;
        }
        #northAmericaMapContainer #dominicanrepublic {
            position: absolute;
            bottom: 20%;
            left: 78.5%;
        }
        /* africa map */
        #africaMapContainer .location {
            height: 20px;
            width: 20px;
        }
        #africaMapContainer #marroco {
            position: absolute;
            bottom: 93%;
            left: 20%;
        }
        #africaMapContainer #egypt {
            position: absolute;
            bottom: 87%;
            left: 63%;
        }
        #africaMapContainer #algeria {
            position: absolute;
            bottom: 88%;
            left: 30%;
        }
        #africaMapContainer #libya {
            position: absolute;
            bottom: 88%;
            left: 48%;
        }
        #africaMapContainer #tunisia {
            position: absolute;
            bottom: 96%;
            left: 39%;
        }
        #africaMapContainer #westernsahara {
            position: absolute;
            bottom: 84%;
            left: 12%;
        }
        #africaMapContainer #senegal {
            position: absolute;
            bottom: 70%;
            left: 12%;
        }
        #africaMapContainer #gambia {
            position: absolute;
            bottom: 67.8%;
            left: 9%;
        }
        #africaMapContainer #mauritania {
            position: absolute;
            bottom: 77%;
            left: 15%;
        }
        #africaMapContainer #mali {
            position: absolute;
            bottom: 75%;
            left: 25%;
        }
        #africaMapContainer #niger {
            position: absolute;
            bottom: 74%;
            left: 40%;
        }
        #africaMapContainer #chade {
            position: absolute;
            bottom: 73%;
            left: 51%;
        }
        #africaMapContainer #sudan {
            position: absolute;
            bottom: 73%;
            left: 64%;
        }
        #africaMapContainer #eritrea {
            position: absolute;
            bottom: 72%;
            left: 74%;
        }
        #africaMapContainer #guineabissau {
            position: absolute;
            bottom: 66%;
            left: 9.5%;
        }
        #africaMapContainer #guinea {
            position: absolute;
            bottom: 65%;
            left: 14%;
        }
        #africaMapContainer #sierraleona {
            position: absolute;
            bottom: 61%;
            left: 14%;
        }
        #africaMapContainer #liberia {
            position: absolute;
            bottom: 59%;
            left: 16.5%;
        }
        #africaMapContainer #cotedivoire {
            position: absolute;
            bottom: 60%;
            left: 21%;
        }
        #africaMapContainer #burkinafaso {
            position: absolute;
            bottom: 67%;
            left: 26%;
        }
        #africaMapContainer #ghana {
            position: absolute;
            bottom: 61%;
            left: 26.5%;
        }
        #africaMapContainer #togo {
            position: absolute;
            bottom: 60%;
            left: 29.5%;
        }
        #africaMapContainer #benin {
            position: absolute;
            bottom: 63%;
            left: 31.3%;
        }
        #africaMapContainer #nigeria {
            position: absolute;
            bottom: 62.5%;
            left: 37%;
        }
        #africaMapContainer #cameroon {
            position: absolute;
            bottom: 57%;
            left: 43%;
        }
        #africaMapContainer #centralafricanrepublic {
            position: absolute;
            bottom: 59%;
            left: 52.5%;
        }
        #africaMapContainer #southsudan {
            position: absolute;
            bottom: 59%;
            left: 64.5%;
        }
        #africaMapContainer #ethiopia {
            position: absolute;
            bottom: 62%;
            left: 75%;
        }
        #africaMapContainer #somalia {
            position: absolute;
            bottom: 61%;
            left: 87%;
        }
        #africaMapContainer #kenya {
            position: absolute;
            bottom: 50%;
            left: 74%;
        }
        #africaMapContainer #uganda {
            position: absolute;
            bottom: 51%;
            left: 67.5%;
        }
        #africaMapContainer #democraticrepublicofthecongo {
            position: absolute;
            bottom: 48%;
            left: 57%;
        }
        #africaMapContainer #republicofthecongo {
            position: absolute;
            bottom: 48%;
            left: 47%;
        }
        #africaMapContainer #gabon {
            position: absolute;
            bottom: 48%;
            left: 42%;
        }
        #africaMapContainer #equatorialguinea {
            position: absolute;
            bottom: 51.5%;
            left: 41%;
        }
        #africaMapContainer #djibouti {
            position: absolute;
            bottom: 66%;
            left: 80%;
        }
        #africaMapContainer #rwanda {
            position: absolute;
            bottom: 47%;
            left: 64.6%;
        }
        #africaMapContainer #burundi {
            position: absolute;
            bottom: 44.5%;
            left: 64.6%;
        }
        #africaMapContainer #tanzania {
            position: absolute;
            bottom: 40.5%;
            left: 70%;
        }
        #africaMapContainer #angola {
            position: absolute;
            bottom: 32%;
            left: 49%;
        }
        #africaMapContainer #zambia {
            position: absolute;
            bottom: 29.5%;
            left: 60%;
        }
        #africaMapContainer #malawi {
            position: absolute;
            bottom: 31%;
            left: 69%;
        }
        #africaMapContainer #mozambique {
            position: absolute;
            bottom: 25%;
            left: 70%;
        }
        #africaMapContainer #zimbabwe {
            position: absolute;
            bottom: 23%;
            left: 64%;
        }
        #africaMapContainer #botswana {
            position: absolute;
            bottom: 20%;
            left: 57%;
        }
        #africaMapContainer #namibia {
            position: absolute;
            bottom: 20%;
            left: 49%;
        }
        #africaMapContainer #southafrica {
            position: absolute;
            bottom: 9%;
            left: 57%;
        }
        #africaMapContainer #lesotho {
            position: absolute;
            bottom: 9%;
            left: 61%;
        }
        #africaMapContainer #swaziland {
            position: absolute;
            bottom: 13%;
            left: 65.5%;
        }
        #africaMapContainer #madagascar {
            position: absolute;
            bottom: 23%;
            left: 84%;
        }
        /* math btn option designs */
        .MathLevelOption {
            height: 200px;
            width: 100%;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            animation: buttonAnimation 2s ease;
            margin-bottom: 20px;
        }
        .MathLevelOption.hard {
            background: linear-gradient(135deg, red, darkred);
        }
        .MathLevelOption.medium {
            background: linear-gradient(135deg, orange, darkorange);
        }
        .MathLevelOption.easy {
            background: linear-gradient(135deg, green, darkgreen);
        }
        .MathLevelOption .mathsimbol {
            font-size: 1em;
            color: #fff;
            opacity: 0.5;
            position: absolute;
        }
        .MathLevelOption .btngrid {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 100%;
            background-size: 20px 20px;
            background-image: linear-gradient(#fff 1px, transparent 1px),
                linear-gradient(90deg, #fff 1px, transparent 1px);
            opacity: 0.2;
        }
        .MathLevelOption .text {
            font-size: 50px;
            font-weight: bold;
            color: white;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            justify-content: center;
            align-items: center;
            display: flex;
            font-family: 'Orbitron', sans-serif;
        }
        .hinge .part1 {
            height: 2px;
            width: 20px;
            background-color: #fff;
            position: absolute;
            transform: rotate(50deg) translateY(-10px);
            
        }
        .hinge .part1:after {
            content: "";
            height: 5px;
            width: 5px;
            border-radius: 5px;
            background-color: #fff;
            position: absolute;
            left: -2.5px;
            top: -1.5px;
        }
        .hinge .part2 {
            height: 2px;
            width: 20px;
            background-color: #fff;
            position: absolute;
            transform: rotate(-50deg) translateY(10px);
            
        }
        .hinge .part2:after {
            content: "";
            height: 5px;
            width: 5px;
            border-radius: 5px;
            background-color: #fff;
            position: absolute;
            left: -2.5px;
            top: -1.5px;
        }
        .hinge .part2:before {
            content: "";
            height: 5px;
            width: 5px;
            border-radius: 5px;
            background-color: #fff;
            position: absolute;
            right: -1px;
            top: -2px;
        }
        .greenColor1 {
            color: var(--green-color1);
        }
        .green2.greenColor1, .red1.greenColor1, .orange1.greenColor1 {
            color: var(--text-color);
        }
        .MathInputField, input[type="text"].MathInputField {
            padding: 15px;
            border: 2px solid var(--text-color);
            border-radius: 10px;
            font-size: 0.9em;
            color: var(--text-color);
            background-color: var(--bg-color);
            transition: 0.3s;
        }
        input[type="text"].MathInputField.green2 {
            background-color: var(--green-color2);
        }
        input[type="text"].MathInputField.orange1 {
            background-color: var(--orange-color1);
        }
        input[type="text"].MathInputField.red1 {
            background-color: var(--red-color1);
        }
        /*shapes*/
        .shape-container {
            background: var(--bg-color);
            display: inline-flex;
            justify-content: center;
            align-items: center;
            touch-action: none;
            margin-right: 10px;
            overflow: hidden;
            padding: 30px;
        }
        @keyframes sceneAnimation {
            from {
                opacity: 0;
                transform: translateY(-20px) rotateX(0) rotateY(0);
                box-shadow: 0px 20px 50px rgba(0, 0, 0, 0.3);
            }
            to {
                opacity: 1;
                transform: translateY(0) rotateX(-19deg) rotateY(6deg);
                box-shadow: none;
            }
        }
        .scene {
            width: 145px;
            height: 150px;
            transform-style: preserve-3d;
            display: flex;
            transition: transform 0.1s ease;
            border: 2px dashed var(--text-color);
            animation: sceneAnimation 2s ease;
            transform: rotateX(-19deg) rotateY(6deg);
        }
        /* square-based pyramid*/
        .pyramid {
            position: relative;
            transform-style: preserve-3d;
        }
        
        .pyramid .face {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            opacity: 0.9;
        }
        
        .pyramid .base {
            width: 140px;
            height: 140px;
            background: #0135FF;
            transform: rotateX(90deg) translateZ(-39px);
            position: absolute;
            opacity: 0.7;
            top: 0;
            left: 0;
        }
        
        .pyramid .face1 {
            border-width: 0 70px 120px 70px;
            border-color: transparent transparent #e74c3c transparent;
            transform: rotateY(0deg) translateZ(35px) rotateX(36deg);
        }
        
        .pyramid .face2 {
            border-width: 0 70px 120px 70px;
            border-color: transparent transparent #27ae60 transparent;
            transform: rotateY(90deg) translateZ(35px) rotateX(36deg);
        }
        
        .pyramid .face3 {
            border-width: 0 70px 120px 70px;
            border-color: transparent transparent #2980b9 transparent;
            transform: rotateY(180deg) translateZ(35px) rotateX(36deg);
        }
        
        .pyramid .face4 {
            border-width: 0 70px 120px 70px;
            border-color: transparent transparent #f1c40f transparent;
            transform: rotateY(-90deg) translateZ(35px) rotateX(36deg);
        }
        /* cylinder */
        .cylinder {
            position: relative;
            width: 140px;
            height: 120px;
            transform-style: preserve-3d;
            transform: translateY(10px);
        }
        
        .cylinder .cylinder-top,
        .cylinder .cylinder-bottom {
            position: absolute;
            width: 140px;
            height: 140px;
            border-radius: 50%;
            background: #2ecc71;
            transform: rotateX(90deg);
            opacity: 0.7;
            left: 0;
            top: 0;
        }
        
        .cylinder .cylinder-top {
            transform: rotateX(90deg) translateZ(60px);
            background: #2ecc71;
        }
        
        .cylinder .cylinder-bottom {
            transform: rotateX(90deg) translateZ(-60px);
            background: #f1c40f;
        }
        
        .cylinder .cylinder-side {
            position: absolute;
            width: 140px;
            height: 120px;
            transform-style: preserve-3d;
            top: 10px;
            left: 0;
        }
        
        .cylinder .segment {
            position: absolute;
            width: 13px;
            height: 120px;
            background: #e74c3c;
            left: 63.5px;
            transform-origin: center center;
            opacity: 0.9;
        }
        /* cone */
        .cone {
            position: relative;
            transform-style: preserve-3d;
        }
        
        .cone .cone-side {
            position: absolute;
            width: 200px;
            height: 200px;
            transform-style: preserve-3d;
        }
        
        .cone .segment {
            position: absolute;
            width: 10px;
            height: 0;
            border-left: 3px solid transparent;
            border-right: 3px solid transparent;
            border-bottom: 120px solid #e67e22;
            transform-origin: bottom center;
            top: 59px;
            left: 65px;
        }
        
        .cone .cone-base {
            width: 140px;
            height: 140px;
            background: #2980b9;
            border-radius: 50%;
            transform: rotateX(90deg) translateZ(-60px);
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.7;
        }
        /* triangular prism */
        .triangular-prism {
            position: relative;
            transform-style: preserve-3d;
        }
        
        .triangular-prism .face {
            position: absolute;
            opacity: 0.9;
        }
        
        .triangular-prism .triangle {
            width: 0;
            height: 0;
            border-left: 70px solid transparent;
            border-right: 70px solid transparent;
            border-bottom: 120px solid #e74c3c;
        }
        
        .triangular-prism .rectangle {
            width: 140px;
            height: 120px;
            background: #27ae60;
        }
        
        .triangular-prism .face1 {
            transform: translateZ(70px);
        }
        
        .triangular-prism .face2 {
            transform: rotateY(180deg) translateZ(70px);
        }
        
        .triangular-prism .face3 {
            background: #2980b9;
            transform: rotateX(90deg) translateY(70px) translateZ(20px);
            width: 140px;
            height: 140px;
            transform-origin: bottom;
        }
        
        .triangular-prism .face4 {
            background: #f1c40f;
            width: 140px;
            height: 139px;
            transform: rotateY(90deg) rotateX(-30deg) translateX(-70px) translateZ(25.5px) translateY(-26px);
            transform-origin: left;
        }
        
        .triangular-prism .face5 {
            background: #9b59b6;
            width: 140px;
            height: 139px;
            transform: rotateY(-90deg) rotateX(-30deg) translateX(70px) translateZ(25.5px) translateY(-26px);
            transform-origin: right;
        }
        /* cuboid */
        .cuboid {
            position: relative;
            transform-style: preserve-3d;
            width: 140px;
            height: 140px;
            transform: translateZ(-70px);
        }
        
        .cuboid .face {
            position: absolute;
            background: rgba(0, 0, 0, 0.1);
            border: 1px solid #333;
            opacity: 0.9;
        }
        
        .cuboid .face-front {
            width: 140px;
            height: 120px;
            background: #e74c3c;
            transform: translateY(10px) translateX(0) translateZ(195px);
        }
        
        .cuboid .face-back {
            width: 140px;
            height: 120px;
            background: #27ae60;
            transform: rotateY(180deg) translateY(10px) translateX(0) translateZ(45px);
        }
        
        .cuboid .face-left {
            width: 240px;
            height: 120px;
            background: #2980b9;
            transform: rotateY(-90deg) translateY(10px) translateX(75px) translateZ(-20px);
        }
        
        .cuboid .face-right {
            width: 240px;
            height: 120px;
            background: #f1c40f;
            transform: rotateY(90deg) translateY(10px) translateX(-75px) translateZ(-120px);
        }
        
        .cuboid .face-top {
            width: 140px;
            height: 240px;
            background: #8e44ad;
            transform: rotateX(90deg) translateY(75px) translateX(0) translateZ(110px);
        }
        
        .cuboid .face-bottom {
            width: 140px;
            height: 240px;
            background: #3498db;
            transform: rotateX(-90deg) translateY(-75px) translateX(0) translateZ(10px);
        }
        /* cube */
        .cube {
            position: relative;
            transform-style: preserve-3d;
            width: 140px;
            height: 140px;
            transform: translateZ(-70px); /* half-depth */
        }
    
        .cube .face {
            position: absolute;
            background: rgba(0,0,0,0.1);
            border: 1px solid #333;
            opacity: 0.9;
        }
    
        .cube .face-front {
          width: 140px;
          height: 140px;
          background: #e74c3c;
          transform: translateY(0) translateX(0) translateZ(145px);
        }
        
        .cube .face-back {
            width: 140px;
            height: 140px;
            background: #27ae60;
            transform: rotateY(180deg) translateY(0) translateX(0) translateZ(-5px);
        }
    
        .cube .face-left {
          width: 140px;
          height: 140px;
          background: #2980b9;
          transform: rotateY(-90deg) translateY(0) translateX(75px) translateZ(-70px);
        }
    
        .cube .face-right {
            width: 140px;
            height: 140px;
            background: #f1c40f;
            transform: rotateY(90deg) translateY(0) translateX(-75px) translateZ(-70px);
        }
    
        .cube .face-top {
            width: 140px;
            height: 140px;
            background: #8e44ad;
            transform: rotateX(90deg) translateY(75px) translateX(0) translateZ(70px);
        }
    
        .cube .face-bottom {
            width: 140px;
            height: 140px;
            background: #3498db;
            transform: rotateX(-90deg) translateY(-75px) translateX(0) translateZ(70px);
        }
        /* tetrahedron */
        .tetrahedron {
            position: relative;
            transform-style: preserve-3d;
        }
        
        .tetrahedron .triangle-face {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-bottom: 105px solid red;
            opacity: 0.9;
            transform-origin: bottom center;
        }
        
        .tetrahedron .face1 {
            transform: rotateX(-19.5deg) translateZ(-37px) translateY(21px) translateX(10px);
            border-bottom: 105px solid #f1c40f;
        }
        
        .tetrahedron .face2 {
            transform: rotateY(120deg) rotateX(-19.5deg) translateZ(-19px) translateX(1px) translateY(15px);
            border-bottom: 105px solid #e74c3c;
        }
        
        .tetrahedron .face3 {
            transform: rotateY(-120deg) rotateX(-19.5deg) translateZ(-35px) translateX(-11px) translateY(21px);
            border-bottom: 105px solid #27ae60;
        }
        
        .tetrahedron .base {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 60px solid transparent;
            border-right: 60px solid transparent;
            border-top: 105px solid blue;
            transform: rotateX(90deg) translateZ(-60px) translateY(10px) translateX(10px);
            opacity: 0.7;
        }
        .audio-button {
            background: #777;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s ease;
            position: absolute;
            top: -20px;
            right: -20px;
        }
        @media(max-width: 900px) {
            .resizesidebarbar {
                display: none;
            }
            #chat-sidebar {
                position: absolute;
                top: 15px;
                left: 15px;
                height: 100%;
            }
        }
    </style>
</head>
<body>
    <section id="content-container" class="sidebarEnabled">
        <section id="sidebar">
            <div id="profile">
                <div id="profilePicContainer">
                    <img id="profilePic" src="/src/person.png">
                    <img id="profilePic" src="/src/person2.png">
                </div>
                <div id="profileInfo">
                    <h4 id="userName">Name</h4>
                    <p id="extraUserInfo">age</p>
                </div>
            </div>
            <div id="sidebar-button-container">
                <button id="learnbtn" class="Active" onclick="showSection('learncontainer', this)">learn</button>
                <button id="chatbtn" onclick="showSection('chatcontainer', this)">chat</button>
                <button id="calendarbtn" onclick="showSection('calendarcontainer', this)">calendar</button>
                <button id="homeworkbtn" onclick="showSection('homeworkcontainer', this)">home work</button>
                <button id="savedbtn" onclick="showSection('savedcontainer', this)">saved</button>
            </div>
            <div class="resizesidebarbar">></div>
        </section>
        <section class="section" id="learncontainer">
            <div id="progress-bar-container">
                <div id="progress-bar-bar-container">
                    <div id="progress-bar">
                        <div class="progress-bar-fill" id="Fill1"></div>
                        <div class="progress-bar-fill" id="Fill2"></div>
                        <div class="progress-bar-fill" id="Fill3"></div>
                        <div class="progress-bar-fill" id="Fill4"></div>
                    </div>
                </div>
                <div id="pointsContainer">
                    <div id="pointsIcon">
                        #
                    </div>
                    <div id="points">
                        0
                    </div>
                </div>
            </div>
            <div id="content">
                <div class="content" id="choose-content">
                    
                </div>
                <div class="content" id="learn-content"></div>
                <div class="content" id="help-content"></div>
                <div id="timer-container">
                    <button id="icon">◵</button>
                    <button id="time">00:09</button>
                </div>
                <button class="learnOp" id="backBtn">quit</button>
                <button class="learnOp" id="skipBtn">skip</button>
            </div>
            <div id="loading">
                <div id="spinner"></div>
            </div>
        </section>
        <section class="section" id="chatcontainer">
                <div class="sec-content chatSidebarEnabled" id="chat-container">
                    <section id="chat-sidebar">
                        <h2>chat</h2>
                        <input type="text" oninput="searchForServer()" placeholder="servers">
                        <div id="server-container"></div>
                    </section>
                    <section id="chat-content">
                        <div id="chat-messages">
                            <span id="emptyChatText">open a chat</span>
                        </div>
                        <form id="message-form" onsubmit="sendMessage(event)">
                            <textarea id="message-input" placeholder="Type a message..." maxlength="100000" required></textarea>
                            <button type="submit">Send</button>
                        </form>
                    </section>
                </div>
        </section>
        <section class="section" id="calendarcontainer">
            <div class="sec-content" id="calendar-content">
                
            </div>
        </section>
        <section class="section" id="homeworkcontainer">
            <div class="sec-content" id="homework-content">
                
            </div>
        </section>
        <section class="section" id="savedcontainer">
            <div class="sec-content" id="saved-content">
                
            </div>
        </section>
    </section>
    <script>
        const progress1 = document.getElementById('Fill1');
        const progress2 = document.getElementById('Fill2');
        const progress3 = document.getElementById('Fill3');
        const progress4 = document.getElementById('Fill4');
        const progresses = [progress1, progress2, progress3, progress4];
        const chooseContent = document.getElementById('choose-content');
        const learnContent = document.getElementById('learn-content');
        const helpContent = document.getElementById('help-content');
        const progressBarContainer = document.getElementById('progress-bar-container');
        const loading = document.getElementById('loading');
        const countDownTimeDisplay = document.getElementById('time');
        const timerContainer = document.getElementById('timer-container');
        const backBtn = document.getElementById('backBtn');
        const skipBtn = document.getElementById('skipBtn');
        const pointsElement = document.getElementById('points');
        const pointsContainer = document.getElementById('pointsContainer');
        const emptyChatText = document.getElementById('emptyChatText');
        let points = parseInt(localStorage.getItem('AIluryLearnPoints'));
        if (!points) points = 0;
        pointsElement.textContent = points;
        let progress = 0;
        let maxprogress = 10;
        let ignoredmR = 0;
        let textTTSenabled = true;
        let currentProgressElement = 0;
        const countDownTime = 5; // from 9 to 1
        const maxlooptries = 10;
        let skipdisplay = "inline";
        let quitdisplay = "inline";
        
        async function libreTranslate(text, targetLang = 'de') {
            const response = await fetch('https://libretranslate.de/translate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    q: text,
                    source: 'auto',
                    target: targetLang,
                    format: 'text'
                })
            });
            
            const result = await response.json();
            return result.translatedText;
        }
        function ttsToTranslateLang(ttsLang) {
            const map = {
                'en-US': 'en',
                'en-GB': 'en',
                'pt-BR': 'pt',
                'pt-PT': 'pt',
                'de-DE': 'de',
                'fr-FR': 'fr',
                'es-ES': 'es',
                'it-IT': 'it',
                'ja-JP': 'ja',
                'ko-KR': 'ko',
                'zh-CN': 'zh',
                'zh-TW': 'zh-TW',
                'ru-RU': 'ru',
                'tr-TR': 'tr',
                'ar-SA': 'ar',
                'nl-NL': 'nl',
                'pl-PL': 'pl',
                'sv-SE': 'sv',
                'fi-FI': 'fi',
                'no-NO': 'no',
                'da-DK': 'da',
                'cs-CZ': 'cs',
                'el-GR': 'el',
                'ro-RO': 'ro',
                'hu-HU': 'hu'
            };
            
            // fallback: nur den ISO-Code extrahieren (z.B. "en-US" → "en")
            return map[ttsLang] || ttsLang.split('-')[0];
        }
        const TTS = (() => {
            const synth = window.speechSynthesis;
            let currentUtterance = null;
            
            // Unterstützte Sprachcodes
            const supportedLangs = ['en-US', 'de-DE', 'es-ES', 'pt-BR', 'fr-FR'];
            
            async function speak(rtext, lang = 'auto') {
                if (!rtext || typeof rtext !== 'string') return;
                startLoad();
                let ttsLang = ttsToTranslateLang(navigator.language);
                if (lang == "auto") {
                    ttsLang = ttsToTranslateLang(ttsLang);
                }
                let text = await libreTranslate(rtext, ttsLang);
                await stop();
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Sprache ermitteln oder verwenden
                let selectedLang = lang === 'auto' ? detectLanguage(text) : lang;
                
                // Fallback auf Gerätesprache, falls nicht unterstützt
                if (!supportedLangs.includes(selectedLang)) {
                    selectedLang = navigator.language || 'en-US';
                }
                
                utterance.lang = selectedLang;
                currentUtterance = utterance;
                
                utterance.onend = () => {
                    currentUtterance = null;
                };
                utterance.onerror = (e) => {
                    console.error('Speech error:', e);
                    currentUtterance = null;
                };
                
                synth.speak(utterance);
                stopLoad();
            }
            
            function stop() {
                if (synth.speaking || synth.pending) {
                    synth.cancel();
                }
                currentUtterance = null;
            }
            
            // Einfache heuristische Spracherkennung
            function detectLanguage(text) {
                const t = text.toLowerCase();
                
                if (/[äöüß]/.test(t)) return 'de-DE';
                if (/[áéíóúñ]/.test(t)) return 'es-ES';
                if (/[àèéêç]/.test(t)) return 'fr-FR';
                if (/[ãõç]/.test(t)) return 'pt-BR';
                if (/[\w]/.test(t)) return 'en-US';
                
                return navigator.language || 'en-US';
            }
            
            return {
                speak,
                stop
            };
        })();
        let ttsRunning = false;
        function addAudioButton(el, text = "") {
            if (textTTSenabled) {
                const ttsBtn = document.createElement('button');
                ttsBtn.className = "audio-button";
                ttsBtn.textContent = "▶";
                el.appendChild(ttsBtn);
                ttsBtn.onclick = () => {
                    if (ttsRunning == false) {
                        ttsRunning = true;
                        TTS.speak(text);
                    } else {
                        ttsRunning = false;
                        TTS.stop();
                    }
                };
            }
        }
        let isResizingSidebar = false;
        
        document.querySelector('.resizesidebarbar').addEventListener('touchstart', (e) => {
            isResizingSidebar = true;
        });
        
        window.addEventListener('touchmove', (e) => {
            if (!isResizingSidebar) return;
            e.preventDefault();
            const viewportWidth = document.documentElement.clientWidth;
            const vw = (e.touches[0].clientX / viewportWidth) * 100;
            document.documentElement.style.setProperty('--sidebar-width', `${vw}vw`);
        });
        
        window.addEventListener('touchend', () => {
            isResizingSidebar = false;
        });
        
        document.querySelector('.resizesidebarbar').addEventListener('mousedown', (e) => {
            isResizingSidebar = true;
        });
        
        window.addEventListener('mousemove', (e) => {
            if (!isResizingSidebar) return;
            const viewportWidth = document.documentElement.clientWidth;
            const vw = (e.clientX / viewportWidth) * 100;
            document.documentElement.style.setProperty('--sidebar-width', `${vw}vw`);
        });
        
        window.addEventListener('mouseup', () => {
            isResizingSidebar = false;
        });
        
        const textarea = document.getElementById('message-input');
        
        textarea.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });
        async function typeEffect(element, text) {
            let allLetters = text.split('').reverse();
            for (let i = 0; i < text.length; i++) {
                element.querySelectorAll('.cursorElement').forEach(el => el.remove());
                element.textContent += allLetters.pop();
                if (i != text.length - 1) {
                    const cursorSpan = document.createElement('span');
                    cursorSpan.textContent = "|";
                    cursorSpan.className = "cursorElement";
                    element.appendChild(cursorSpan);
                }
                await new Promise(resolve => setTimeout(resolve, 90));
            }
        }
        function showSection(sectionid, btn) {
            document.querySelectorAll('.section').forEach(sec => sec.style.display = "none");
            document.getElementById(sectionid).style.display = "flex";
            document.querySelectorAll('#sidebar-button-container .Active').forEach(el => el.classList.remove('Active'));
            if (sectionid == "chatcontainer") {
                emptyChatText.textContent = "";
                if (emptyChatText.style.display != "none") {
                typeEffect(emptyChatText, "open a chat");
                }
            }
            btn.classList.add('Active');
        }
        async function UpdateNumber(el, number, goalNum) {
            if (goalNum > number) {
                for (let i = number; i <= goalNum; i++) {
                    el.textContent = i;
                    await new Promise(resolve => setTimeout(resolve, 30)); // optional schneller
                }
            } else {
                for (let i = number; i >= goalNum; i--) {
                    el.textContent = i;
                    await new Promise(resolve => setTimeout(resolve, 30));
                }
            }
        }
        function updatePoints() {
            localStorage.setItem('AIluryLearnPoints', points);
            let number = parseInt(pointsElement.textContent);
            if (isNaN(number)){
                number = 0;
            }
            if (points > number) {
                pointsContainer.style.animation = "none";
                void pointsContainer.offsetWidth;
                pointsContainer.style.animation = "pointAnimation 2s ease";
            }
            UpdateNumber(pointsElement, number, points)
        }
        function startLoad() {
            loading.style.display = "flex";
        }
        function stopLoad() {
            loading.style.display = "none";
        }
        let continueLoop = false;
        async function countDown(callback) {
            timerContainer.style.display = "block";
            skipBtn.style.display = "none";
            continueLoop = true;
            timerContainer.onclick = () => {
                timerContainer.onclick = null;
                continueLoop = false;
                timerContainer.style.display = "none";
                skipBtn.style.display = skipdisplay;
            };
            for (let i = countDownTime; i >= 0; i--) {
                if (continueLoop) {
                    countDownTimeDisplay.textContent = "00:" + (i < 10 ? "0" + i : i);
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
            }
            timerContainer.style.display = "none";
            skipBtn.style.display = skipdisplay;
            callback();
        }
        
        function shuffleArray(array) {
            const arr = array.slice();
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }
        function cutArray(array, maxArraySize = 20) {
            if (array.length < maxArraySize) return array;
            return array
                .slice()
                .sort(() => Math.random() - 0.5)
                .slice(0, maxArraySize);
        }
        function addQuestion(data, callback, lastindex = -0) {
            let qindex = lastindex + 1;
            
            let currentdata = data[qindex];
            if (!currentdata) {
                stopQuestions();
                fetchQuestions("/questions/questions.json");
                return;
            }
            if (currentProgressElement != progresses.length - 1) {
                skipBtn.onclick = () => {
                    currentProgressElement++;
                    if (currentProgressElement == progresses.length - 1) {
                        skipdisplay = "none";
                        skipBtn.style.display = "none";
                    }
                    callback(qindex);
                };
            }
            learnContent.innerHTML = `<p>${currentdata.text}</p>`;
            maxprogress = data.length;
            if (currentdata.type == "multiop" && currentdata.options) {
                const currentArray = shuffleArray(currentdata.options);
                currentArray.forEach((op, index) => {
                    const div1 = document.createElement('div');
                    const div2 = document.createElement('div');
                    const div3 = document.createElement('div');
                    div1.className = "optionBtn";
                    div2.className = "optionFill";
                    div1.id = "optionBtn" + index;
                    div2.id = "optionFill" + index;
                    addAudioButton(div1, op.text);
                    div1.onclick = (event) => {
                        if (event.target && event.target.classList.contains('audio-button')) return;
                        if (parseInt(op.percent) > 85) {
                            div1.classList.add("green2");
                        } else if (parseInt(op.percent) > 35) {
                            div1.classList.add("orange2");
                        } else {
                            div1.classList.add("red2");
                        }
                        if (parseInt(op.percent) > 85) {
                            div2.classList.add("green1");
                        } else if (parseInt(op.percent) > 35) {
                            div2.classList.add("orange1");
                        } else {
                            div2.classList.add("red1");
                        }
                        if (parseInt(op.percent) > 50) {
                            points += Math.round(parseInt(op.percent) / 10);
                        } else {
                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                        }
                        updatePoints();
                        div2.style.width = op.percent + "%";
                        div1.onclick = null;
                        currentArray.forEach((el, index2) => {
                            if (index != index2) {
                                const op = document.getElementById("optionBtn" + index2);
                                const opfill = document.getElementById("optionFill" + index2);
                                const opText = document.getElementById("optionTitle" + index2);
                                opfill.style.width = el.percent + "%";
                                op.onclick = null;
                                if (el.correct == true && op && opfill) {
                                    opfill.classList.add("green1");
                                    op.classList.add("green2");
                                } else if (op && opfill) {
                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                    //opText.textContent = el.result;
                                }
                            }
                        });
                        progress = qindex;
                        maxprogress = data.length - 1;
                        const percentage = (progress / maxprogress) * 100;
                        progresses[currentProgressElement].style.width = `${percentage}%`;
                        countDown(() => {
                            callback(qindex);
                        });
                    };
                    div3.className = "optionTitle";
                    div3.id = "optionTitle" + index;
                    div3.textContent = op.text;
                    //div2.textContent = op.percent;
                    //div1.textContent = "option" + index;
                    div1.appendChild(div2);
                    div1.appendChild(div3);
                    div1.style.pointerEvents = "none";
                    setTimeout(() => {
                        learnContent.appendChild(div1);
                        if (index == currentArray.length - 1) {
                            skipBtn.style.display = skipdisplay;
                            backBtn.style.display = quitdisplay;
                            currentArray.forEach((el, index2) => {
                                const op = document.getElementById("optionBtn" + index2);
                                op.style.pointerEvents = "auto";
                            });
                        }
                    }, index * 100);
                });
            }
            else if (currentdata.type === "continentPick" && currentdata.options) {
                const continentsMapContainer = document.createElement('div');
                continentsMapContainer.id = "continentsMapContainer";
                
                const img = document.createElement('img');
                img.src = "/src/continentMap.png";
                continentsMapContainer.appendChild(img);
                
                const allContinents = currentdata.options;
                
                allContinents.forEach(continent => {
                    const location = document.createElement('span');
                    location.id = continent.text;
                    location.className = "location";
                    continentsMapContainer.appendChild(location);
                    
                    location.onclick = () => {
                        /*if (continent.correct === true) {
                            points += 10;
                        } else {
                            points -= 10;
                        }*/
                        if (parseInt(continent.percent) > 50) {
                            points += Math.round(parseInt(continent.percent) / 10);
                        } else {
                            points -= Math.round((100 - parseInt(continent.percent)) / 20);
                        }
                        const percent = parseInt(continent.percent, 10);
                        if (percent > 85) {
                            location.classList.add("green1");
                        } else if (percent > 35) {
                            location.classList.add("orange1");
                        } else {
                            location.classList.add("red1");
                        }
                        
                        updatePoints();
                        
                        // Disable all click events after selection
                        allContinents.forEach(c => {
                            const loc = continentsMapContainer.querySelector(`#${CSS.escape(c.text)}`);
                            if (loc) {
                                loc.onclick = null;
                                if (c.correct == true && loc.id != continent.text) {
                                    loc.classList.add("green1");
                                }
                                else if (loc.id != continent.text) {
                                    loc.style.backgroundColor = "var(--default-bbg-color)";
                                }
                            }
                        });
                        
                        progress = qindex;
                        maxprogress = data.length - 1;
                        const percentage = (progress / maxprogress) * 100;
                        progresses[currentProgressElement].style.width = `${percentage}%`;
                        
                        countDown(() => {
                            callback(qindex);
                        });
                    };
                });
                const randomQuestionIndex = Math.floor(Math.random() * currentdata.text.length);
                learnContent.innerHTML = `<p>${currentdata.text[randomQuestionIndex]}</p>`;
                learnContent.appendChild(continentsMapContainer);
                skipBtn.style.display = skipdisplay;
                backBtn.style.display = quitdisplay;
            }
            else if (currentdata.type === "EuropeCountryPick" && currentdata.options) {
                const europeMapContainer = document.createElement('div');
                europeMapContainer.id = "europeMapContainer";
                
                const img = document.createElement('img');
                img.src = "/src/europeMap.jpeg";
                europeMapContainer.appendChild(img);
                
                const allCountries = currentdata.options;
                
                allCountries.forEach(continent => {
                    const location = document.createElement('span');
                    location.id = continent.text;
                    location.className = "location";
                    europeMapContainer.appendChild(location);
                    
                    location.onclick = () => {
                        /*if (continent.correct === true) {
                            points += 10;
                        } else {
                            points -= 10;
                        }*/
                        console.log(continent.text);
                        if (parseInt(continent.percent) > 50) {
                            points += Math.round(parseInt(continent.percent) / 10);
                        } else {
                            points -= Math.round((100 - parseInt(continent.percent)) / 20);
                        }
                        const percent = parseInt(continent.percent, 10);
                        if (percent > 85) {
                            location.classList.add("green1");
                        } else if (percent > 35) {
                            location.classList.add("orange1");
                        } else {
                            location.classList.add("red1");
                        }
                        
                        updatePoints();
                        
                        // Disable all click events after selection
                        const locs = Array.from(europeMapContainer.querySelectorAll(`.location`));
                        allCountries.forEach((con, index) => {
                            const loc = locs[index];
                            if (loc) {
                                loc.onclick = null;
                                if (con.correct == true && loc.id != continent.text) {
                                    loc.classList.add("green1");
                                }
                                else if (loc.id != continent.text && con.correct == false) {
                                    loc.style.backgroundColor = "var(--default-bbg-color)";
                                }
                            }
                        });
                        console.log(continent.text);
                        progress = qindex;
                        maxprogress = data.length - 1;
                        const percentage = (progress / maxprogress) * 100;
                        progresses[currentProgressElement].style.width = `${percentage}%`;
                        
                        countDown(() => {
                            callback(qindex);
                        });
                    };
                });
                const randomQuestionIndex = Math.floor(Math.random() * currentdata.text.length);
                learnContent.innerHTML = `<p>${currentdata.text[randomQuestionIndex]}</p>`;
                learnContent.appendChild(europeMapContainer);
                skipBtn.style.display = skipdisplay;
                backBtn.style.display = quitdisplay;
            }
            else if (currentdata.type === "NorthAmericanCountryPick" && currentdata.options) {
                const northAmericaMapContainer = document.createElement('div');
                northAmericaMapContainer.id = "northAmericaMapContainer";
                
                const img = document.createElement('img');
                img.src = "/src/northAmericaMap.jpeg";
                northAmericaMapContainer.appendChild(img);
                
                const allCountries = currentdata.options;
                
                allCountries.forEach(continent => {
                    const location = document.createElement('span');
                    location.id = continent.text;
                    location.className = "location";
                    northAmericaMapContainer.appendChild(location);
                    
                    location.onclick = () => {
                        /*if (continent.correct === true) {
                            points += 10;
                        } else {
                            points -= 10;
                        }*/
                        console.log(continent.text);
                        if (parseInt(continent.percent) > 50) {
                            points += Math.round(parseInt(continent.percent) / 10);
                        } else {
                            points -= Math.round((100 - parseInt(continent.percent)) / 20);
                        }
                        const percent = parseInt(continent.percent, 10);
                        if (percent > 85) {
                            location.classList.add("green1");
                        } else if (percent > 35) {
                            location.classList.add("orange1");
                        } else {
                            location.classList.add("red1");
                        }
                        
                        updatePoints();
                        
                        // Disable all click events after selection
                        const locs = Array.from(northAmericaMapContainer.querySelectorAll(`.location`));
                        allCountries.forEach((con, index) => {
                            const loc = locs[index];
                            if (loc) {
                                loc.onclick = null;
                                if (con.correct == true && loc.id != continent.text) {
                                    loc.classList.add("green1");
                                }
                                else if (loc.id != continent.text && con.correct == false) {
                                    loc.style.backgroundColor = "var(--default-bbg-color)";
                                }
                            }
                        });
                        console.log(continent.text);
                        progress = qindex;
                        maxprogress = data.length - 1;
                        const percentage = (progress / maxprogress) * 100;
                        progresses[currentProgressElement].style.width = `${percentage}%`;
                        
                        countDown(() => {
                            callback(qindex);
                        });
                    };
                });
                const randomQuestionIndex = Math.floor(Math.random() * currentdata.text.length);
                learnContent.innerHTML = `<p>${currentdata.text[randomQuestionIndex]}</p>`;
                learnContent.appendChild(northAmericaMapContainer);
                skipBtn.style.display = skipdisplay;
                backBtn.style.display = quitdisplay;
            }
            else if (currentdata.type === "AfricaCountryPick" && currentdata.options) {
                const africaMapContainer = document.createElement('div');
                africaMapContainer.id = "africaMapContainer";
                
                const img = document.createElement('img');
                img.src = "/src/africaMap.svg";
                africaMapContainer.appendChild(img);
                
                const allCountries = currentdata.options;
                
                allCountries.forEach(continent => {
                    const location = document.createElement('span');
                    location.id = continent.text;
                    location.className = "location";
                    africaMapContainer.appendChild(location);
                    
                    location.onclick = () => {
                        /*if (continent.correct === true) {
                            points += 10;
                        } else {
                            points -= 10;
                        }*/
                        console.log(continent.text);
                        if (parseInt(continent.percent) > 50) {
                            points += Math.round(parseInt(continent.percent) / 10);
                        } else {
                            points -= Math.round((100 - parseInt(continent.percent)) / 20) ;
                        }
                        const percent = parseInt(continent.percent, 10);
                        if (percent > 85) {
                            location.classList.add("green1");
                        } else if (percent > 35) {
                            location.classList.add("orange1");
                        } else {
                            location.classList.add("red1");
                        }
                        
                        updatePoints();
                        
                        // Disable all click events after selection
                        const locs = Array.from(africaMapContainer.querySelectorAll(`.location`));
                        allCountries.forEach((con, index) => {
                            const loc = locs[index];
                            if (loc) {
                                loc.onclick = null;
                                if (con.correct == true && loc.id != continent.text) {
                                    loc.classList.add("green1");
                                }
                                else if (loc.id != continent.text && con.correct == false) {
                                    loc.style.backgroundColor = "var(--default-bbg-color)";
                                }
                            }
                        });
                        console.log(continent.text);
                        progress = qindex;
                        maxprogress = data.length - 1;
                        const percentage = (progress / maxprogress) * 100;
                        progresses[currentProgressElement].style.width = `${percentage}%`;
                        
                        countDown(() => {
                            callback(qindex);
                        });
                    };
                });
                const randomQuestionIndex = Math.floor(Math.random() * currentdata.text.length);
                learnContent.innerHTML = `<p>${currentdata.text[randomQuestionIndex]}</p>`;
                learnContent.appendChild(africaMapContainer);
                skipBtn.style.display = skipdisplay;
                backBtn.style.display = quitdisplay;
            }
        }
        function addMathOptions(data, callback) {
            learnContent.innerHTML = ""; // alte Buttons entfernen
            
            const keys = Object.keys(data);
            for (const key of keys) {
                if (key == "hard") {
                    const mathLevelOption = document.createElement("div");
                    mathLevelOption.className = "MathLevelOption hard";
                    const btngrid = document.createElement("div");
                    btngrid.className = "btngrid";
                    mathLevelOption.appendChild(btngrid);
                    const text = document.createElement("div");
                    text.className = "text";
                    const hinge = document.createElement("div");
                    hinge.className = "hinge";
                    const part1 = document.createElement("div");
                    part1.className = "part1";
                    hinge.appendChild(part1);
                    const part2 = document.createElement("div");
                    part2.className = "part2";
                    hinge.appendChild(part2);
                    text.textContent = key;
                    text.appendChild(hinge);
                    mathLevelOption.appendChild(text);
                    mathLevelOption.addEventListener("click", () => {
                        callback(key); // z. B. "easy", "medium", "hard"
                    });
                    learnContent.appendChild(mathLevelOption);
                }else if (key == "medium") {
                    const mathLevelOption = document.createElement("div");
                    mathLevelOption.className = "MathLevelOption medium";
                    const text = document.createElement("div");
                    text.className = "text";
                    const mathSymbols = [
                      '+', '-', '×', '÷', '·', '/',
                      '=', '≠', '<', '>', '≤', '≥', '≈', '≡',
                      '∠', '°', '′', '″', '⊥', '∥', '△', '◯', 'π',
                      '∈', '∉', '⊂', '⊆', '⊄', '∪', '∩', '∅', '{}',
                      'ℕ', 'ℤ', 'ℚ', 'ℝ', 'ℂ',
                      '¬', '∧', '∨', '⇒', '⇔', '∀', '∃',
                      'f(x)', 'f′(x)', 'f″(x)', '∂', 'Δ', '∇', '∞', 'lim',
                      '∑', '∏', '√', '∛', '|x|', '!', '⊕'
                    ];
                    for (let i = 0; i < 50; i++) {
                        const symbol = document.createElement("div");
                        symbol.className = "mathsimbol";
                        symbol.textContent = mathSymbols[Math.floor(Math.random() * mathSymbols.length)];
                        mathLevelOption.appendChild(symbol);
                        const x = Math.floor(Math.random() * 100);
                        const y = Math.floor(Math.random() * 100);
                        symbol.style.top = y + "%";
                        symbol.style.left = i * 2 + "%";
                    }
                    text.textContent = key;
                    mathLevelOption.appendChild(text);
                    mathLevelOption.addEventListener("click", () => {
                        callback(key); // z. B. "easy", "medium", "hard"
                    });
                    learnContent.appendChild(mathLevelOption);
                }else if (key == "easy") {
                    const mathLevelOption = document.createElement("div");
                    mathLevelOption.className = "MathLevelOption easy";
                    const text = document.createElement("div");
                    text.className = "text";
                    text.textContent = key;
                    mathLevelOption.appendChild(text);
                    mathLevelOption.addEventListener("click", () => {
                        callback(key); // z. B. "easy", "medium", "hard"
                    });
                    learnContent.appendChild(mathLevelOption);
                }
            }
        }
        function addMathQuestions(rdata, level) {
            const fileName = "questions/math/" + level + "math.json";
            startLoad();
            fetch(fileName)
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                })
                .then(data => {
                    stopLoad();
                    const shuffled = shuffleArray(cutArray(data));
                    function addQuestionAuto(rindex = -0) {
                        skipBtn.style.display = "none";
                        maxprogress = 19;
                        if (rindex == maxprogress) {
                            stopQuestions();
                            fetchQuestions("/questions/questions.json");
                            return;
                        }
                        let randomTypeOfExercise = rdata[Math.floor(Math.random() * rdata.length)];
                        while (randomTypeOfExercise == "quiz" && (!data || data.length === 0)) {
                            randomTypeOfExercise = rdata[Math.floor(Math.random() * rdata.length)];
                        }
                        if (currentProgressElement != progresses.length - 1) {
                            skipBtn.onclick = () => {
                                currentProgressElement++;
                                rindex++;
                                if (currentProgressElement == progresses.length - 1) {
                                    skipdisplay = "none";
                                    skipBtn.style.display = "none";
                                }
                                addQuestionAuto(rindex);
                            };
                        }
                        function shuffleArray(array) {
                            for (let i = array.length - 1; i > 0; i--) {
                                const j = Math.floor(Math.random() * (i + 1)); // random index from 0 to i
                                [array[i], array[j]] = [array[j], array[i]]; // swap
                            }
                            return array;
                        }
                        function formatNumberSmart(num) {
                            return parseFloat(num.toFixed(2));
                        }
                        function addCorrectAnswerToSection(questionsection, correctAnswer) {
                            const resultspantag = document.createElement('span');
                            resultspantag.textContent = " correct answer: " + correctAnswer;
                            questionsection.appendChild(resultspantag);
                        }
                        if (randomTypeOfExercise == "quiz"){
                            const randomObject = shuffled[Math.floor(Math.random() * shuffled.length)];
                                    learnContent.innerHTML = "";
                                    const questionSpan = document.createElement("span");
                                    questionSpan.textContent = `${randomObject.text[Math.floor(Math.random() * randomObject.text.length)]}`;
                                    learnContent.appendChild(questionSpan);
                                        const alloptions = shuffleArray(randomObject.options);
                                        alloptions.forEach((op, index) => {
                                            const div1 = document.createElement('div');
                                            const div2 = document.createElement('div');
                                            const div3 = document.createElement('div');
                                            div1.className = "optionBtn";
                                            div2.className = "optionFill";
                                            div1.id = "optionBtn" + index;
                                            div2.id = "optionFill" + index;
                                            addAudioButton(div1, op.text);
                                            div1.onclick = (event) => {
                                                if (event.target && event.target.classList.contains('audio-button')) return;
                                                if (parseInt(op.percent) > 85) {
                                                    div1.classList.add("green2");
                                                } else if (parseInt(op.percent) > 35) {
                                                    div1.classList.add("orange2");
                                                } else {
                                                    div1.classList.add("red2");
                                                }
                                                if (parseInt(op.percent) > 85) {
                                                    div2.classList.add("green1");
                                                } else if (parseInt(op.percent) > 35) {
                                                    div2.classList.add("orange1");
                                                } else {
                                                    div2.classList.add("red1");
                                                }
                                                if (parseInt(op.percent) > 50) {
                                                    points += Math.round(parseInt(op.percent) / 10);
                                                } else {
                                                    points -= Math.round((100 - parseInt(op.percent)) / 20);
                                                }
                                                updatePoints();
                                                div2.style.width = op.percent + "%";
                                                div1.onclick = null;
                                                alloptions.forEach((el, index2) => {
                                                    if (index != index2) {
                                                        const op = document.getElementById("optionBtn" + index2);
                                                        const opfill = document.getElementById("optionFill" + index2);
                                                        const opText = document.getElementById("optionTitle" + index2);
                                                        opfill.style.width = el.percent + "%";
                                                        op.onclick = null;
                                                        if (el.correct == true && op && opfill) {
                                                            opfill.classList.add("green1");
                                                            op.classList.add("green2");
                                                        } else if (op && opfill) {
                                                            opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                            op.style.backgroundColor = "var(--default-fbg-color)";
                                                            //opText.textContent = el.result;
                                                        }
                                                    }
                                                });
                                                rindex++;
                                                progress = rindex;
                                                const percentage = (progress / maxprogress) * 100;
                                                progresses[currentProgressElement].style.width = `${percentage}%`;
                                                countDown(() => {
                                                    addQuestionAuto(rindex);
                                                });
                                            };
                                            div3.className = "optionTitle";
                                            div3.id = "optionTitle" + index;
                                            div3.textContent = op.text;
                                            //div2.textContent = op.percent;
                                            //div1.textContent = "option" + index;
                                            div1.appendChild(div2);
                                            div1.appendChild(div3);
                                            div1.style.pointerEvents = "none";
                                            setTimeout(() => {
                                                learnContent.appendChild(div1);
                                                if (index == alloptions.length - 1) {
                                                    skipBtn.style.display = skipdisplay;
                                                    backBtn.style.display = quitdisplay;
                                                    alloptions.forEach((el, index2) => {
                                                        const op = document.getElementById("optionBtn" + index2);
                                                        op.style.pointerEvents = "auto";
                                                    });
                                                }
                                            }, index * 100);
                                        });
                        } else if (randomTypeOfExercise == "numbergrid") {
                            const startNumber = Math.floor(Math.random() * 100);
                            let endNumber = Math.floor(Math.random() * 100);
                            while (startNumber == endNumber) {
                                endNumber = Math.floor(Math.random() * 100);
                            }
                            let questionText = "bigger or smaller";
                            let smallerNumber = 0;
                            let biggerNumber = 0;
                            if (startNumber > endNumber) {
                                questionText = `What number is ${startNumber - endNumber} smaller than ${startNumber}`;
                                biggerNumber = startNumber;
                                smallerNumber = endNumber;
                            } else if (startNumber < endNumber) {
                                questionText = `What number is ${endNumber - startNumber} bigger than ${startNumber}`;
                                biggerNumber = endNumber;
                                smallerNumber = startNumber;
                            }
                            
                            learnContent.innerHTML = questionText;
                            
                            function floorToTen(n) {
                                return Math.floor(n / 10) * 10;
                            }
                            
                            function nextTen(n) {
                                return Math.ceil((n + 1) / 10) * 10;
                            }
                            
                            let difference = biggerNumber - smallerNumber;
                            
                            if (difference < 100) {
                                let result = 100 - difference;
                                let randomNum = Math.floor(Math.random() * 3);
                                
                                if (randomNum === 1) {
                                    if (smallerNumber > result) {
                                        smallerNumber -= result;
                                    } else {
                                        // Restbetrag wird biggerNumber zugeschlagen
                                        biggerNumber += result - smallerNumber;
                                        smallerNumber = 0;
                                    }
                                } else if (randomNum === 2) {
                                    let half = Math.round(result / 2);
                                    if (smallerNumber > half) {
                                        smallerNumber -= half;
                                    } else {
                                        biggerNumber += half - smallerNumber;
                                        smallerNumber = 0;
                                    }
                                    biggerNumber += half;
                                } else {
                                    biggerNumber += result;
                                }
                            }
                            const newGridElContainer = document.createElement('span');
                            newGridElContainer.className = "NumberGrid";
                            for (let i = floorToTen(smallerNumber); i <= nextTen(biggerNumber) - 1; i++) {
                                const newGridElSpan = document.createElement('span');
                                newGridElSpan.textContent = i;
                                newGridElSpan.className = "gridNumber";
                                if (i == startNumber) {
                                    newGridElSpan.classList.add("greenColor1");
                                } else if (i == endNumber) {
                                    newGridElSpan.classList.add("correctMathGridAnswer");
                                }
                                newGridElSpan.onclick = () => {
                                    if (i == endNumber) {
                                        newGridElSpan.classList.add("green2");
                                        points += 10;
                                    } else if (i < endNumber + 10 && i > endNumber - 10) {
                                        newGridElSpan.classList.add("orange1");
                                        points += 5;
                                    } else {
                                        newGridElSpan.classList.add("red1");
                                        points -= 5;
                                    }
                                    updatePoints();
                                    document.querySelectorAll('.gridNumber').forEach(gn => {
                                        if (gn.classList.contains("correctMathGridAnswer")) {
                                            gn.classList.add("green2");
                                        }
                                        gn.onclick = null;
                                    });
                                    rindex++;
                                    progress = rindex;
                                    //maxprogress = data.length - 1;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                };
                                newGridElContainer.appendChild(newGridElSpan);
                            }
                            learnContent.appendChild(newGridElContainer);
                            skipBtn.style.display = skipdisplay;
                        }
                        else if (randomTypeOfExercise == "addition") {
                            function randomNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 100);
                                } else if (level == "medium") {
                                    return Math.floor(Math.random() * 500);
                                }
                                return Math.floor(Math.random() * 1000);
                            }
                            const firstNum = randomNumbeGen();
                            const secondNum = randomNumbeGen();
                            
                            learnContent.innerHTML = `What is ${firstNum} + ${secondNum} ?`;
                            const correctAnswer = firstNum + secondNum;
                            
                            const multiopOrInput = Math.floor(Math.random() * 2);
                            if (multiopOrInput == 1) {
                                let alloptions1 = [
                                    {
                                        "text": `${correctAnswer}`,
                                        "result": "correct",
                                        "percent": "100",
                                        "correct": false
                                    }
                                ];
                                
                                const randomAmout = Math.floor(Math.random() * 5) + 3;
                                let allOps = [correctAnswer];
                                for (let i = 0; i < randomAmout; i ++) {
                                    let firstWrongNum = randomNumbeGen();
                                    let secondWrongNum = randomNumbeGen();
                                    while (allOps.includes(formatNumberSmart(firstWrongNum + secondWrongNum)) || !Number.isFinite(formatNumberSmart(firstWrongNum + secondWrongNum))) {
                                        firstWrongNum = randomNumbeGen();
                                        secondWrongNum = randomNumbeGen();
                                    }
                                    const oneWrongAnswer = firstWrongNum + secondWrongNum;
                                    /*let difference = correctAnswer > oneWrongAnswer ?
                                        correctAnswer - oneWrongAnswer :
                                        oneWrongAnswer - correctAnswer;*/
                                    let difference = Math.abs(correctAnswer - oneWrongAnswer);
                                    let scale = Math.abs(correctAnswer) > 0 ? Math.abs(correctAnswer) : 1;
                                    
                                    let percent = 100 - (difference / scale * 100);
                                    percent = Math.max(0, Math.min(100, percent));
                                    
                                    alloptions1.push({
                                        "text": `${oneWrongAnswer}`,
                                        "result": `Incorrect`,
                                        "percent": percent,
                                        "correct": false
                                    });
                                }
                                const alloptions = shuffleArray(alloptions1);
                                alloptions.forEach((op, index) => {
                                    const div1 = document.createElement('div');
                                    const div2 = document.createElement('div');
                                    const div3 = document.createElement('div');
                                    div1.className = "optionBtn";
                                    div2.className = "optionFill";
                                    div1.id = "optionBtn" + index;
                                    div2.id = "optionFill" + index;
                                    div1.onclick = () => {
                                        if (parseInt(op.percent) > 85) {
                                            div1.classList.add("green2");
                                        } else if (parseInt(op.percent) > 35) {
                                            div1.classList.add("orange2");
                                        } else {
                                            div1.classList.add("red2");
                                        }
                                        if (parseInt(op.percent) > 85) {
                                            div2.classList.add("green1");
                                        } else if (parseInt(op.percent) > 35) {
                                            div2.classList.add("orange1");
                                        } else {
                                            div2.classList.add("red1");
                                        }
                                        if (parseInt(op.percent) > 50) {
                                            points += Math.round(parseInt(op.percent) / 10);
                                        } else {
                                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                                        }
                                        updatePoints();
                                        div2.style.width = op.percent + "%";
                                        div1.onclick = null;
                                        alloptions.forEach((el, index2) => {
                                            if (index != index2) {
                                                const op = document.getElementById("optionBtn" + index2);
                                                const opfill = document.getElementById("optionFill" + index2);
                                                const opText = document.getElementById("optionTitle" + index2);
                                                opfill.style.width = el.percent + "%";
                                                op.onclick = null;
                                                if (el.correct == true && op && opfill) {
                                                    opfill.classList.add("green1");
                                                    op.classList.add("green2");
                                                } else if (op && opfill) {
                                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                                    //opText.textContent = el.result;
                                                }
                                            }
                                        });
                                        rindex++;
                                        progress = rindex;
                                        const percentage = (progress / maxprogress) * 100;
                                        progresses[currentProgressElement].style.width = `${percentage}%`;
                                        countDown(() => {
                                            addQuestionAuto(rindex);
                                        });
                                    };
                                    div3.className = "optionTitle";
                                    div3.id = "optionTitle" + index;
                                    div3.textContent = op.text;
                                    //div2.textContent = op.percent;
                                    //div1.textContent = "option" + index;
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    div1.style.pointerEvents = "none";
                                    setTimeout(() => {
                                        learnContent.appendChild(div1);
                                        if (index == alloptions.length - 1) {
                                            skipBtn.style.display = skipdisplay;
                                            backBtn.style.display = quitdisplay;
                                            alloptions.forEach((el, index2) => {
                                                const op = document.getElementById("optionBtn" + index2);
                                                op.style.pointerEvents = "auto";
                                            });
                                        }
                                    }, index * 100);
                                });
                            } else {
                                const inputEl = document.createElement("input");
                                inputEl.type = "text";
                                inputEl.className = "MathInputField";
                                inputEl.placeholder = "Enter your answer here...";
                                function userAnswerSubmit() {
                                    const inputValue = parseInt(inputEl.value);
                                    
                                    if (isNaN(inputValue)) {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else if (inputValue == correctAnswer) {
                                        inputEl.classList.add("green2");
                                        points += 10;
                                    } else if (inputValue < correctAnswer + 10 && inputValue > correctAnswer - 10) {
                                        inputEl.classList.add("orange1");
                                        points += 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    }
                                    updatePoints();
                                    rindex++;
                                    progress = rindex;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                }
                                inputEl.onkeydown = (event) => {
                                    if (event.key == "Enter") {
                                        inputEl.onkeydown = null;
                                        userAnswerSubmit();
                                    }
                                };
                                learnContent.appendChild(inputEl);
                                skipBtn.style.display = skipdisplay;
                            }
                        }
                        else if (randomTypeOfExercise == "subtraction") {
                            function randomNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 100);
                                } else if (level == "medium") {
                                    return Math.floor(Math.random() * 500);
                                }
                                return Math.floor(Math.random() * 1000);
                            }
                            const firstNum = randomNumbeGen();
                            const secondNum = randomNumbeGen();
                            
                            learnContent.innerHTML = `What is ${firstNum} - ${secondNum} ?`;
                            const correctAnswer = firstNum - secondNum;
                            
                            const multiopOrInput = Math.floor(Math.random() * 2);
                            if (multiopOrInput == 1) {
                                let alloptions1 = [
                                    {
                                        "text": `${correctAnswer}`,
                                        "result": "correct",
                                        "percent": "100",
                                        "correct": false
                                    }
                                ];
                                
                                const randomAmout = Math.floor(Math.random() * 5) + 3;
                                let allOps = [correctAnswer];
                                for (let i = 0; i < randomAmout; i ++) {
                                    let firstWrongNum = randomNumbeGen();
                                    let secondWrongNum = randomNumbeGen();
                                    while (allOps.includes(formatNumberSmart(firstWrongNum - secondWrongNum)) || !Number.isFinite(formatNumberSmart(firstWrongNum - secondWrongNum))) {
                                        firstWrongNum = randomNumbeGen();
                                        secondWrongNum = randomNumbeGen();
                                    }
                                    const oneWrongAnswer = firstWrongNum - secondWrongNum;
                                    let difference = Math.abs(correctAnswer - oneWrongAnswer);
                                    let scale = Math.abs(correctAnswer) > 0 ? Math.abs(correctAnswer) : 1;
                                    
                                    let percent = 100 - (difference / scale * 100);
                                    percent = Math.max(0, Math.min(100, percent));
                                    
                                    alloptions1.push({
                                        "text": `${oneWrongAnswer}`,
                                        "result": `Incorrect`,
                                        "percent": percent,
                                        "correct": false
                                    });
                                }
                                const alloptions = shuffleArray(alloptions1);
                                alloptions.forEach((op, index) => {
                                    const div1 = document.createElement('div');
                                    const div2 = document.createElement('div');
                                    const div3 = document.createElement('div');
                                    div1.className = "optionBtn";
                                    div2.className = "optionFill";
                                    div1.id = "optionBtn" + index;
                                    div2.id = "optionFill" + index;
                                    div1.onclick = () => {
                                        if (parseInt(op.percent) > 85) {
                                            div1.classList.add("green2");
                                        } else if (parseInt(op.percent) > 35) {
                                            div1.classList.add("orange2");
                                        } else {
                                            div1.classList.add("red2");
                                        }
                                        if (parseInt(op.percent) > 85) {
                                            div2.classList.add("green1");
                                        } else if (parseInt(op.percent) > 35) {
                                            div2.classList.add("orange1");
                                        } else {
                                            div2.classList.add("red1");
                                        }
                                        if (parseInt(op.percent) > 50) {
                                            points += Math.round(parseInt(op.percent) / 10);
                                        } else {
                                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                                        }
                                        updatePoints();
                                        div2.style.width = op.percent + "%";
                                        div1.onclick = null;
                                        alloptions.forEach((el, index2) => {
                                            if (index != index2) {
                                                const op = document.getElementById("optionBtn" + index2);
                                                const opfill = document.getElementById("optionFill" + index2);
                                                const opText = document.getElementById("optionTitle" + index2);
                                                opfill.style.width = el.percent + "%";
                                                op.onclick = null;
                                                if (el.correct == true && op && opfill) {
                                                    opfill.classList.add("green1");
                                                    op.classList.add("green2");
                                                } else if (op && opfill) {
                                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                                    //opText.textContent = el.result;
                                                }
                                            }
                                        });
                                        rindex++;
                                        progress = rindex;
                                        const percentage = (progress / maxprogress) * 100;
                                        progresses[currentProgressElement].style.width = `${percentage}%`;
                                        countDown(() => {
                                            addQuestionAuto(rindex);
                                        });
                                    };
                                    div3.className = "optionTitle";
                                    div3.id = "optionTitle" + index;
                                    div3.textContent = op.text;
                                    //div2.textContent = op.percent;
                                    //div1.textContent = "option" + index;
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    div1.style.pointerEvents = "none";
                                    setTimeout(() => {
                                        learnContent.appendChild(div1);
                                        if (index == alloptions.length - 1) {
                                            skipBtn.style.display = skipdisplay;
                                            backBtn.style.display = quitdisplay;
                                            alloptions.forEach((el, index2) => {
                                                const op = document.getElementById("optionBtn" + index2);
                                                op.style.pointerEvents = "auto";
                                            });
                                        }
                                    }, index * 100);
                                });
                            } else {
                                const inputEl = document.createElement("input");
                                inputEl.type = "text";
                                inputEl.className = "MathInputField";
                                inputEl.placeholder = "Enter your answer here...";
                                function userAnswerSubmit() {
                                    const inputValue = parseInt(inputEl.value);
                                    
                                    if (isNaN(inputValue)) {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else if (inputValue == correctAnswer) {
                                        inputEl.classList.add("green2");
                                        points += 10;
                                    } else if (inputValue < correctAnswer + 10 && inputValue > correctAnswer - 10) {
                                        inputEl.classList.add("orange1");
                                        points += 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    }
                                    updatePoints();
                                    rindex++;
                                    progress = rindex;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                }
                                inputEl.onkeydown = (event) => {
                                    if (event.key == "Enter") {
                                        inputEl.onkeydown = null;
                                        userAnswerSubmit();
                                    }
                                };
                                learnContent.appendChild(inputEl);
                                skipBtn.style.display = skipdisplay;
                            }
                        
                        }
                        else if (randomTypeOfExercise == "division") {
                            function randomNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 20); //parseFloat((Math.random() * 100).toFixed(2));
                                }
                                return Math.floor(Math.random() * 100);//parseFloat((Math.random() * 500).toFixed(2));
                            }
                            const firstNum = randomNumbeGen();
                            const secondNum = randomNumbeGen();
                            
                            learnContent.innerHTML = `What is ${firstNum} ÷ ${secondNum} ?`;
                            const correctAnswer = formatNumberSmart(firstNum / secondNum);
                            
                            const multiopOrInput = Math.floor(Math.random() * 2);
                            
                            if (multiopOrInput == 1) {
                                let alloptions1 = [
                                    {
                                        "text": `${correctAnswer}`,
                                        "result": "correct",
                                        "percent": "100",
                                        "correct": false
                                    }
                                ];
                                
                                const randomAmout = Math.floor(Math.random() * 5) + 3;
                                let allOps = [correctAnswer];
                                for (let i = 0; i < randomAmout; i ++) {
                                    let firstWrongNum = randomNumbeGen();
                                    let secondWrongNum = randomNumbeGen();
                                    while (allOps.includes(formatNumberSmart(firstWrongNum / secondWrongNum)) || !Number.isFinite(formatNumberSmart(firstWrongNum / secondWrongNum))) {
                                        firstWrongNum = randomNumbeGen();
                                        secondWrongNum = randomNumbeGen();
                                    }
                                    const oneWrongAnswer = formatNumberSmart(firstWrongNum / secondWrongNum);
                                    allOps.push(oneWrongAnswer);
                                    let difference = Math.abs(correctAnswer - oneWrongAnswer);
                                    let scale = Math.abs(correctAnswer) > 0 ? Math.abs(correctAnswer) : 1;
                                    
                                    let percent = 100 - (difference / scale * 100);
                                    percent = Math.max(0, Math.min(100, percent));
                                    
                                    alloptions1.push({
                                        "text": `${oneWrongAnswer}`,
                                        "result": `Incorrect`,
                                        "percent": percent,
                                        "correct": false
                                    });
                                }
                                const alloptions = shuffleArray(alloptions1);
                                alloptions.forEach((op, index) => {
                                    const div1 = document.createElement('div');
                                    const div2 = document.createElement('div');
                                    const div3 = document.createElement('div');
                                    div1.className = "optionBtn";
                                    div2.className = "optionFill";
                                    div1.id = "optionBtn" + index;
                                    div2.id = "optionFill" + index;
                                    div1.onclick = () => {
                                        if (parseInt(op.percent) > 85) {
                                            div1.classList.add("green2");
                                        } else if (parseInt(op.percent) > 35) {
                                            div1.classList.add("orange2");
                                        } else {
                                            div1.classList.add("red2");
                                        }
                                        if (parseInt(op.percent) > 85) {
                                            div2.classList.add("green1");
                                        } else if (parseInt(op.percent) > 35) {
                                            div2.classList.add("orange1");
                                        } else {
                                            div2.classList.add("red1");
                                        }
                                        if (parseInt(op.percent) > 50) {
                                            points += Math.round(parseInt(op.percent) / 10);
                                        } else {
                                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                                        }
                                        updatePoints();
                                        div2.style.width = op.percent + "%";
                                        div1.onclick = null;
                                        alloptions.forEach((el, index2) => {
                                            if (index != index2) {
                                                const op = document.getElementById("optionBtn" + index2);
                                                const opfill = document.getElementById("optionFill" + index2);
                                                const opText = document.getElementById("optionTitle" + index2);
                                                opfill.style.width = el.percent + "%";
                                                op.onclick = null;
                                                if (el.correct == true && op && opfill) {
                                                    opfill.classList.add("green1");
                                                    op.classList.add("green2");
                                                } else if (op && opfill) {
                                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                                    //opText.textContent = el.result;
                                                }
                                            }
                                        });
                                        rindex++;
                                        progress = rindex;
                                        const percentage = (progress / maxprogress) * 100;
                                        progresses[currentProgressElement].style.width = `${percentage}%`;
                                        countDown(() => {
                                            addQuestionAuto(rindex);
                                        });
                                    };
                                    div3.className = "optionTitle";
                                    div3.id = "optionTitle" + index;
                                    div3.textContent = op.text;
                                    //div2.textContent = op.percent;
                                    //div1.textContent = "option" + index;
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    div1.style.pointerEvents = "none";
                                    setTimeout(() => {
                                        learnContent.appendChild(div1);
                                        if (index == alloptions.length - 1) {
                                            skipBtn.style.display = skipdisplay;
                                            backBtn.style.display = quitdisplay;
                                            alloptions.forEach((el, index2) => {
                                                const op = document.getElementById("optionBtn" + index2);
                                                op.style.pointerEvents = "auto";
                                            });
                                        }
                                    }, index * 100);
                                });
                            } else {
                                const inputEl = document.createElement("input");
                                inputEl.type = "text";
                                inputEl.className = "MathInputField";
                                inputEl.placeholder = "Enter your answer here...";
                                function userAnswerSubmit() {
                                    const inputValue = formatNumberSmart(parseFloat(inputEl.value));
                                    if (isNaN(inputValue)) {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else if (inputValue == correctAnswer) {
                                        inputEl.classList.add("green2");
                                        points += 10;
                                    } else if (inputValue < correctAnswer + 10 && inputValue > correctAnswer - 10) {
                                        inputEl.classList.add("orange1");
                                        points += 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    }
                                    updatePoints();
                                    rindex++;
                                    progress = rindex;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                }
                                inputEl.onkeydown = (event) => {
                                    if (event.key == "Enter") {
                                        inputEl.onkeydown = null;
                                        userAnswerSubmit();
                                    }
                                };
                                learnContent.appendChild(inputEl);
                                skipBtn.style.display = skipdisplay;
                            }
                        }
                        else if (randomTypeOfExercise == "chain") {
                            function randomSmallNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 8) + 1;
                                } else if (level == "medium") {
                                    return Math.floor(Math.random() * 24) + 1;
                                }
                                return Math.floor(Math.random() * 99) + 1;
                            }
                            function randomNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 99) + 1;
                                } else if (level == "medium") {
                                    return Math.floor(Math.random() * 499) + 1;
                                }
                                return Math.floor(Math.random() * 999) + 1;
                            }
                            function randomAnswerNumbeGen() {
                                let num;
                                if (level == "easy") {
                                    num = Math.random() * 99 + 1;
                                } else if (level == "medium") {
                                    num = Math.random() * 499 + 1;
                                } else {
                                    num = Math.random() * 999 + 1;
                                }
                                
                                return Math.random() < 0.5 ? Math.floor(num) : Math.round(num * 10) / 10;
                            }
                            
                            let randomChainLength = Math.floor(Math.random() * 3) + 3;
                            if (level == "medium") {
                                randomChainLength = Math.floor(Math.random() * 5) + 3;
                            } else if (level == "hard") {
                                randomChainLength = Math.floor(Math.random() * 9) + 3;
                            }
                            const randomEasyOperators = ["+", "-"];
                            const randomMediumOperators = ["*", "/"];
                            const randomOperators = [...randomEasyOperators, ...randomMediumOperators];
                            function generateChainOpResult() {
                                let mathquestiontext = "";
                                for (let i = 0; i < randomChainLength; i++) {
                                    let anotherNum = randomNumbeGen();
                                    const operator = randomOperators[Math.floor(Math.random() * randomOperators.length)];
                                    if (randomMediumOperators.includes(operator)) {
                                        anotherNum = randomSmallNumbeGen();
                                    }
                                    if (i == 0) {
                                        let firstNum = randomNumbeGen();
                                        if (randomMediumOperators.includes(operator)) {
                                            firstNum = randomSmallNumbeGen();
                                        }
                                        mathquestiontext += firstNum + " " + operator + " " + anotherNum;
                                    } else {
                                        mathquestiontext += " " + operator + " " + anotherNum;
                                    }
                                }
                                return mathquestiontext;
                            }
                            
                            let mathquestiongentext = generateChainOpResult();
                            const correctAnswer = formatNumberSmart(eval(mathquestiongentext));
                            learnContent.innerHTML = "What is " + mathquestiongentext + "?";
                            
                            const multiopOrInput = Math.floor(Math.random() * 2);
                            if (multiopOrInput == 1) {
                                let alloptions1 = [
                                    {
                                        "text": `${correctAnswer}`,
                                        "result": "correct",
                                        "percent": "100",
                                        "correct": false
                                    }
                                ];
                                
                                const randomAmout = Math.floor(Math.random() * 5) + 3;
                                let allOps = [correctAnswer];
                                for (let i = 0; i < randomAmout; i ++) {
                                    let wrongNum = generateChainOpResult();
                                    while (allOps.includes(formatNumberSmart(eval(wrongNum))) || !Number.isFinite(formatNumberSmart(eval(wrongNum)))) {
                                        wrongNum = generateChainOpResult();
                                    }
                                    const oneWrongAnswer = formatNumberSmart(eval(wrongNum));
                                    /*let difference = correctAnswer > oneWrongAnswer ?
                                        correctAnswer - oneWrongAnswer :
                                        oneWrongAnswer - correctAnswer;*/
                                    let difference = Math.abs(correctAnswer - oneWrongAnswer);
                                    let scale = Math.abs(correctAnswer) > 0 ? Math.abs(correctAnswer) : 1;
                                    
                                    let percent = 100 - (difference / scale * 100);
                                    percent = Math.max(0, Math.min(100, percent));
                                    
                                    alloptions1.push({
                                        "text": `${oneWrongAnswer}`,
                                        "result": `Incorrect`,
                                        "percent": percent,
                                        "correct": false
                                    });
                                }
                                const alloptions = shuffleArray(alloptions1);
                                alloptions.forEach((op, index) => {
                                    const div1 = document.createElement('div');
                                    const div2 = document.createElement('div');
                                    const div3 = document.createElement('div');
                                    div1.className = "optionBtn";
                                    div2.className = "optionFill";
                                    div1.id = "optionBtn" + index;
                                    div2.id = "optionFill" + index;
                                    div1.onclick = () => {
                                        if (parseInt(op.percent) > 85) {
                                            div1.classList.add("green2");
                                        } else if (parseInt(op.percent) > 35) {
                                            div1.classList.add("orange2");
                                        } else {
                                            div1.classList.add("red2");
                                        }
                                        if (parseInt(op.percent) > 85) {
                                            div2.classList.add("green1");
                                        } else if (parseInt(op.percent) > 35) {
                                            div2.classList.add("orange1");
                                        } else {
                                            div2.classList.add("red1");
                                        }
                                        if (parseInt(op.percent) > 50) {
                                            points += Math.round(parseInt(op.percent) / 10);
                                        } else {
                                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                                        }
                                        updatePoints();
                                        div2.style.width = op.percent + "%";
                                        div1.onclick = null;
                                        alloptions.forEach((el, index2) => {
                                            if (index != index2) {
                                                const op = document.getElementById("optionBtn" + index2);
                                                const opfill = document.getElementById("optionFill" + index2);
                                                const opText = document.getElementById("optionTitle" + index2);
                                                opfill.style.width = el.percent + "%";
                                                op.onclick = null;
                                                if (el.correct == true && op && opfill) {
                                                    opfill.classList.add("green1");
                                                    op.classList.add("green2");
                                                } else if (op && opfill) {
                                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                                    //opText.textContent = el.result;
                                                }
                                            }
                                        });
                                        rindex++;
                                        progress = rindex;
                                        const percentage = (progress / maxprogress) * 100;
                                        progresses[currentProgressElement].style.width = `${percentage}%`;
                                        countDown(() => {
                                            addQuestionAuto(rindex);
                                        });
                                    };
                                    div3.className = "optionTitle";
                                    div3.id = "optionTitle" + index;
                                    div3.textContent = op.text;
                                    //div2.textContent = op.percent;
                                    //div1.textContent = "option" + index;
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    div1.style.pointerEvents = "none";
                                    setTimeout(() => {
                                        learnContent.appendChild(div1);
                                        if (index == alloptions.length - 1) {
                                            skipBtn.style.display = skipdisplay;
                                            backBtn.style.display = quitdisplay;
                                            alloptions.forEach((el, index2) => {
                                                const op = document.getElementById("optionBtn" + index2);
                                                op.style.pointerEvents = "auto";
                                            });
                                        }
                                    }, index * 100);
                                });
                            } else {
                                const inputEl = document.createElement("input");
                                inputEl.type = "text";
                                inputEl.className = "MathInputField";
                                inputEl.placeholder = "Enter your answer here...";
                                function userAnswerSubmit() {
                                    const inputValue = formatNumberSmart(parseFloat(inputEl.value));
                                    
                                    if (isNaN(inputValue)) {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else if (inputValue == correctAnswer) {
                                        inputEl.classList.add("green2");
                                        points += 10;
                                    } else if (inputValue < correctAnswer + 10 && inputValue > correctAnswer - 10) {
                                        inputEl.classList.add("orange1");
                                        points += 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    }
                                    updatePoints();
                                    rindex++;
                                    progress = rindex;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                }
                                inputEl.onkeydown = (event) => {
                                    if (event.key == "Enter") {
                                        inputEl.onkeydown = null;
                                        userAnswerSubmit();
                                    }
                                };
                                learnContent.appendChild(inputEl);
                                skipBtn.style.display = skipdisplay;
                            }
                        }
                        else if (randomTypeOfExercise == "multiplication") {
                            function randomNumbeGen() {
                                if (level == "easy") {
                                    return Math.floor(Math.random() * 9);
                                } else if (level == "medium") {
                                    return Math.floor(Math.random() * 25);
                                }
                                return Math.floor(Math.random() * 100);
                            }
                            const firstNum = randomNumbeGen();
                            const secondNum = randomNumbeGen();
                            
                            learnContent.innerHTML = `What is ${firstNum} × ${secondNum} ?`;
                            const correctAnswer = firstNum * secondNum;
                            
                            const multiopOrInput = Math.floor(Math.random() * 2);
                            if (multiopOrInput == 1) {
                                let alloptions1 = [
                                    {
                                        "text": `${correctAnswer}`,
                                        "result": "correct",
                                        "percent": "100",
                                        "correct": false
                                    }
                                ];
                                
                                const randomAmout = Math.floor(Math.random() * 5) + 3;
                                let allOps = [correctAnswer];
                                for (let i = 0; i < randomAmout; i++) {
                                    let firstWrongNum = randomNumbeGen();
                                    let secondWrongNum = randomNumbeGen();
                                    while (allOps.includes(formatNumberSmart(firstWrongNum * secondWrongNum)) || !Number.isFinite(formatNumberSmart(firstWrongNum * secondWrongNum))) {
                                        firstWrongNum = randomNumbeGen();
                                        secondWrongNum = randomNumbeGen();
                                    }
                                    const oneWrongAnswer = firstWrongNum * secondWrongNum;
                                    /*let difference = correctAnswer > oneWrongAnswer ?
                                        correctAnswer - oneWrongAnswer :
                                        oneWrongAnswer - correctAnswer;*/
                                    let difference = Math.abs(correctAnswer - oneWrongAnswer);
                                    let scale = Math.abs(correctAnswer) > 0 ? Math.abs(correctAnswer) : 1;
                                    
                                    let percent = 100 - (difference / scale * 100);
                                    percent = Math.max(0, Math.min(100, percent));
                                    
                                    alloptions1.push({
                                        "text": `${oneWrongAnswer}`,
                                        "result": `Incorrect`,
                                        "percent": percent,
                                        "correct": false
                                    });
                                }
                                const alloptions = shuffleArray(alloptions1);
                                alloptions.forEach((op, index) => {
                                    const div1 = document.createElement('div');
                                    const div2 = document.createElement('div');
                                    const div3 = document.createElement('div');
                                    div1.className = "optionBtn";
                                    div2.className = "optionFill";
                                    div1.id = "optionBtn" + index;
                                    div2.id = "optionFill" + index;
                                    div1.onclick = () => {
                                        if (parseInt(op.percent) > 85) {
                                            div1.classList.add("green2");
                                        } else if (parseInt(op.percent) > 35) {
                                            div1.classList.add("orange2");
                                        } else {
                                            div1.classList.add("red2");
                                        }
                                        if (parseInt(op.percent) > 85) {
                                            div2.classList.add("green1");
                                        } else if (parseInt(op.percent) > 35) {
                                            div2.classList.add("orange1");
                                        } else {
                                            div2.classList.add("red1");
                                        }
                                        if (parseInt(op.percent) > 50) {
                                            points += Math.round(parseInt(op.percent) / 10);
                                        } else {
                                            points -= Math.round((100 - parseInt(op.percent)) / 20);
                                        }
                                        updatePoints();
                                        div2.style.width = op.percent + "%";
                                        div1.onclick = null;
                                        alloptions.forEach((el, index2) => {
                                            if (index != index2) {
                                                const op = document.getElementById("optionBtn" + index2);
                                                const opfill = document.getElementById("optionFill" + index2);
                                                const opText = document.getElementById("optionTitle" + index2);
                                                opfill.style.width = el.percent + "%";
                                                op.onclick = null;
                                                if (el.correct == true && op && opfill) {
                                                    opfill.classList.add("green1");
                                                    op.classList.add("green2");
                                                } else if (op && opfill) {
                                                    opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                    op.style.backgroundColor = "var(--default-fbg-color)";
                                                    //opText.textContent = el.result;
                                                }
                                            }
                                        });
                                        rindex++;
                                        progress = rindex;
                                        const percentage = (progress / maxprogress) * 100;
                                        progresses[currentProgressElement].style.width = `${percentage}%`;
                                        countDown(() => {
                                            addQuestionAuto(rindex);
                                        });
                                    };
                                    div3.className = "optionTitle";
                                    div3.id = "optionTitle" + index;
                                    div3.textContent = op.text;
                                    //div2.textContent = op.percent;
                                    //div1.textContent = "option" + index;
                                    div1.appendChild(div2);
                                    div1.appendChild(div3);
                                    div1.style.pointerEvents = "none";
                                    setTimeout(() => {
                                        learnContent.appendChild(div1);
                                        if (index == alloptions.length - 1) {
                                            skipBtn.style.display = skipdisplay;
                                            backBtn.style.display = quitdisplay;
                                            alloptions.forEach((el, index2) => {
                                                const op = document.getElementById("optionBtn" + index2);
                                                op.style.pointerEvents = "auto";
                                            });
                                        }
                                    }, index * 100);
                                });
                            } else {
                                const inputEl = document.createElement("input");
                                inputEl.type = "text";
                                inputEl.className = "MathInputField";
                                inputEl.placeholder = "Enter your answer here...";
                                function userAnswerSubmit() {
                                    const inputValue = parseInt(inputEl.value);
                                    
                                    if (isNaN(inputValue)) {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else if (inputValue == correctAnswer) {
                                        inputEl.classList.add("green2");
                                        points += 10;
                                    } else if (inputValue < correctAnswer + 10 && inputValue > correctAnswer - 10) {
                                        inputEl.classList.add("orange1");
                                        points += 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    } else {
                                        inputEl.classList.add("red1");
                                        points -= 5;
                                        addCorrectAnswerToSection(learnContent, correctAnswer);
                                    }
                                    updatePoints();
                                    rindex++;
                                    progress = rindex;
                                    const percentage = (progress / maxprogress) * 100;
                                    progresses[currentProgressElement].style.width = `${percentage}%`;
                                    countDown(() => {
                                        addQuestionAuto(rindex);
                                    });
                                }
                                inputEl.onkeydown = (event) => {
                                    if (event.key == "Enter") {
                                        inputEl.onkeydown = null;
                                        userAnswerSubmit();
                                    }
                                };
                                learnContent.appendChild(inputEl);
                                skipBtn.style.display = skipdisplay;
                            }
                        }
                        else if (randomTypeOfExercise == "shape") {
                            startLoad();
                            fetch("/questions/math/shapes.json")
                                .then(response => {
                                    if (!response.ok) throw new Error("Not found");
                                    return response.json();
                                })
                                .then(shapeQuestionDataList => {
                                    stopLoad();
                                    const randomObject = shapeQuestionDataList[Math.floor(Math.random() * shapeQuestionDataList.length)];
                                    learnContent.innerHTML = "";
                                    function add3del() {
                                        const shapeContainer = document.createElement("div");
                                        shapeContainer.className = "shape-container";
                                        const scene = document.createElement("div");
                                        scene.className = "scene";
                                        scene.id = "scene";
                                        shapeContainer.appendChild(scene);
                                        if (randomObject.name == "squarebasedpyramid") {
                                            const pyramid = document.createElement("div");
                                            pyramid.className = "pyramid";
                                            scene.appendChild(pyramid);
                                            
                                            const face1 = document.createElement("div");
                                            face1.className = "face face1";
                                            pyramid.appendChild(face1);
                                            const face2 = document.createElement("div");
                                            face2.className = "face face2";
                                            pyramid.appendChild(face2);
                                            const face3 = document.createElement("div");
                                            face3.className = "face face3";
                                            pyramid.appendChild(face3);
                                            const face4 = document.createElement("div");
                                            face4.className = "face face4";
                                            pyramid.appendChild(face4);
                                            const base = document.createElement("div");
                                            base.className = "base";
                                            pyramid.appendChild(base);
                                            
                                            learnContent.appendChild(shapeContainer);
                                        } else if (randomObject.name == "cylinder") {
                                            const cylinder = document.createElement("div");
                                            cylinder.className = "cylinder";
                                            scene.appendChild(cylinder);
                                            
                                            const cylinderSide = document.createElement("div");
                                            cylinderSide.className = "cylinder-side";
                                            cylinderSide.id = "cylinder-side";
                                            cylinder.appendChild(cylinderSide);
                                            const cylinderTop = document.createElement("div");
                                            cylinderTop.className = "cylinder-top";
                                            cylinder.appendChild(cylinderTop);
                                            const cylinderBottom = document.createElement("div");
                                            cylinderBottom.className = "cylinder-bottom";
                                            cylinder.appendChild(cylinderBottom);
                                            
                                            const segments = 36;
                                            for (let i = 0; i < segments; i++) {
                                                const segment = document.createElement('div');
                                                segment.className = 'segment';
                                                const angle = (360 / segments) * i;
                                                segment.style.transform = `rotateY(${angle}deg) translateZ(70px)`;
                                                cylinderSide.appendChild(segment);
                                            }
                                            
                                            learnContent.appendChild(shapeContainer);
                                        } else if (randomObject.name == "cone") {
                                            const cone = document.createElement("div");
                                            cone.className = "cone";
                                            scene.appendChild(cone);
                                            
                                            const coneSide = document.createElement("div");
                                            coneSide.className = "cone-side";
                                            coneSide.id = "cone-side";
                                            cone.appendChild(coneSide);
                                            const coneBase = document.createElement("div");
                                            coneBase.className = "cone-base";
                                            cone.appendChild(coneBase);
                                            
                                            const segments = 60;
                                            const radius = 85;
                                            const height = 120;
                                            for (let i = 0; i < segments; i++) {
                                                const segment = document.createElement('div');
                                                segment.className = 'segment';
                                                
                                                const angleY = (360 / segments) * i;
                                                const angleRad = (angleY * Math.PI) / 180;
                                                
                                                // Segmentposition in Kreis (x,z)
                                                const x = radius * Math.sin(angleRad);
                                                const z = radius * Math.cos(angleRad);
                                                
                                                // Vektor zur Spitze (0, -height, 0) - (x, 0, z)
                                                const dx = -x;
                                                const dy = -height;
                                                const dz = -z;
                                                
                                                // Neigungswinkel berechnen (zwischen Segmentrichtung und Vektor zur Spitze)
                                                const horizontalDistance = Math.sqrt(dx * dx + dz * dz);
                                                const tiltAngle = Math.atan2(horizontalDistance, height) * (180 / Math.PI);
                                                
                                                // Transform: zuerst zur Mitte kippen, dann um Y drehen, dann rausrücken
                                                segment.style.transform = `
                                                    rotateY(${angleY}deg)
                                                    rotateX(${tiltAngle}deg)
                                                    translateZ(${radius}px)
                                                  `;
                                                
                                                coneSide.appendChild(segment);
                                            }
                                            
                                            learnContent.appendChild(shapeContainer);
                                        } else if (randomObject.name == "triangularprism") {
                                            const triangularPrism = document.createElement("div");
                                            triangularPrism.className = "triangular-prism";
                                            scene.appendChild(triangularPrism);
                                            
                                            const face1 = document.createElement("div");
                                            face1.className = "face triangle face1";
                                            triangularPrism.appendChild(face1);
                                            const face2 = document.createElement("div");
                                            face2.className = "face triangle face2";
                                            triangularPrism.appendChild(face2);
                                            const face3 = document.createElement("div");
                                            face3.className = "face rectangle face3";
                                            triangularPrism.appendChild(face3);
                                            const face4 = document.createElement("div");
                                            face4.className = "face rectangle face4";
                                            triangularPrism.appendChild(face4);
                                            const face5 = document.createElement("div");
                                            face5.className = "face rectangle face5";
                                            triangularPrism.appendChild(face5);
                                            
                                            learnContent.appendChild(shapeContainer);
                                        } else if (randomObject.name == "cuboid") {
                                            const cuboid = document.createElement("div");
                                            cuboid.className = "cuboid";
                                            scene.appendChild(cuboid);
                                            
                                            const face1 = document.createElement("div");
                                            face1.className = "face face-front";
                                            cuboid.appendChild(face1);
                                            const face2 = document.createElement("div");
                                            face2.className = "face face-back";
                                            cuboid.appendChild(face2);
                                            const face3 = document.createElement("div");
                                            face3.className = "face face-left";
                                            cuboid.appendChild(face3);
                                            const face4 = document.createElement("div");
                                            face4.className = "face face-right";
                                            cuboid.appendChild(face4);
                                            const face5 = document.createElement("div");
                                            face5.className = "face face-top";
                                            cuboid.appendChild(face5);
                                            const face6 = document.createElement("div");
                                            face6.className = "face face-bottom";
                                            cuboid.appendChild(face6);
                                            
                                            learnContent.appendChild(shapeContainer);
                                        } else if (randomObject.name == "cube") {
                                            const cube = document.createElement("div");
                                            cube.className = "cube";
                                            scene.appendChild(cube);
                                            
                                            const face1 = document.createElement("div");
                                            face1.className = "face face-front";
                                            cube.appendChild(face1);
                                            const face2 = document.createElement("div");
                                            face2.className = "face face-back";
                                            cube.appendChild(face2);
                                            const face3 = document.createElement("div");
                                            face3.className = "face face-left";
                                            cube.appendChild(face3);
                                            const face4 = document.createElement("div");
                                            face4.className = "face face-right";
                                            cube.appendChild(face4);
                                            const face5 = document.createElement("div");
                                            face5.className = "face face-top";
                                            cube.appendChild(face5);
                                            const face6 = document.createElement("div");
                                            face6.className = "face face-bottom";
                                            cube.appendChild(face6);
                                            
                                            learnContent.appendChild(shapeContainer);
                                        }
                                        else if (randomObject.name == "tetrahedron") {
                                            const tetrahedron = document.createElement("div");
                                            tetrahedron.className = "tetrahedron";
                                            scene.appendChild(tetrahedron);
                                            
                                            const face1 = document.createElement("div");
                                            face1.className = "triangle-face face1";
                                            tetrahedron.appendChild(face1);
                                            const face2 = document.createElement("div");
                                            face2.className = "triangle-face face2";
                                            tetrahedron.appendChild(face2);
                                            const face3 = document.createElement("div");
                                            face3.className = "triangle-face face3";
                                            tetrahedron.appendChild(face3);
                                            const face4 = document.createElement("div");
                                            face4.className = "base";
                                            tetrahedron.appendChild(face4);
                                            
                                            learnContent.appendChild(shapeContainer);
                                        }
                                        let isDragging = false;
                                            let startX, startY;
                                            let rotationX = -19;
                                            let rotationY = 6;
                                            
                                            function onPointerDown(e) {
                                                isDragging = true;
                                                startX = e.clientX || e.touches[0].clientX;
                                                startY = e.clientY || e.touches[0].clientY;
                                            }
                                            
                                            function onPointerMove(e) {
                                                if (!scene || !scene.parentElement) {
                                                    isDragging = false;
                                                    startX = null;
                                                    startY = null;
                                                    rotationX = 0;
                                                    rotationY = 0;
                                                    // Mouse events
                                                    scene.removeEventListener('mousedown', onPointerDown);
                                                    document.removeEventListener('mousemove', onPointerMove);
                                                    document.removeEventListener('mouseup', onPointerUp);
                                                    
                                                    // Touch events
                                                    scene.removeEventListener('touchstart', onPointerDown, { passive: false });
                                                    document.removeEventListener('touchmove', onPointerMove, { passive: false });
                                                    document.removeEventListener('touchend', onPointerUp);
                                                }
                                                if (!isDragging) return;
                                                const x = e.clientX || e.touches[0].clientX;
                                                const y = e.clientY || e.touches[0].clientY;
                                                
                                                const dx = x - startX;
                                                const dy = y - startY;
                                                
                                                rotationY += dx * 0.5;
                                                rotationX -= dy * 0.5;
                                                
                                                startX = x;
                                                startY = y;
                                                
                                                updateTransform();
                                            }
                                            
                                            function onPointerUp() {
                                                isDragging = false;
                                            }
                                            
                                            // Mouse events
                                            scene.addEventListener('mousedown', onPointerDown);
                                            document.addEventListener('mousemove', onPointerMove);
                                            document.addEventListener('mouseup', onPointerUp);
                                            
                                            // Touch events
                                            scene.addEventListener('touchstart', onPointerDown, { passive: false });
                                            document.addEventListener('touchmove', onPointerMove, { passive: false });
                                            document.addEventListener('touchend', onPointerUp);
                                            function updateTransform() {
                                                
                                                scene.style.transform = `rotateX(${rotationX}deg) rotateY(${rotationY}deg)`;
                                            }
                                    }
                                    const add3Dmodel = Math.floor(Math.random() * 2);
                                    if (level != "hard" && add3Dmodel != 1) {
                                        add3del();
                                    }
                                    const questionSpan = document.createElement("span");
                                    questionSpan.textContent = `${randomObject.text[Math.floor(Math.random() * randomObject.text.length)]}`;
                                    learnContent.appendChild(questionSpan);
                                        const alloptions = shuffleArray(randomObject.options);
                                        alloptions.forEach((op, index) => {
                                            const div1 = document.createElement('div');
                                            const div2 = document.createElement('div');
                                            const div3 = document.createElement('div');
                                            div1.className = "optionBtn";
                                            div2.className = "optionFill";
                                            div1.id = "optionBtn" + index;
                                            div2.id = "optionFill" + index;
                                            addAudioButton(div1, op.text);
                                            div1.onclick = (event) => {
                                                if (event.target && event.target.classList.contains('audio-button')) return;
                                                if (parseInt(op.percent) > 85) {
                                                    div1.classList.add("green2");
                                                } else if (parseInt(op.percent) > 35) {
                                                    div1.classList.add("orange2");
                                                } else {
                                                    div1.classList.add("red2");
                                                }
                                                if (parseInt(op.percent) > 85) {
                                                    div2.classList.add("green1");
                                                } else if (parseInt(op.percent) > 35) {
                                                    div2.classList.add("orange1");
                                                } else {
                                                    div2.classList.add("red1");
                                                }
                                                if (parseInt(op.percent) > 50) {
                                                    points += Math.round(parseInt(op.percent) / 10);
                                                } else {
                                                    points -= Math.round((100 - parseInt(op.percent)) / 20);
                                                }
                                                updatePoints();
                                                div2.style.width = op.percent + "%";
                                                div1.onclick = null;
                                                alloptions.forEach((el, index2) => {
                                                    if (index != index2) {
                                                        const op = document.getElementById("optionBtn" + index2);
                                                        const opfill = document.getElementById("optionFill" + index2);
                                                        const opText = document.getElementById("optionTitle" + index2);
                                                        opfill.style.width = el.percent + "%";
                                                        op.onclick = null;
                                                        if (el.correct == true && op && opfill) {
                                                            opfill.classList.add("green1");
                                                            op.classList.add("green2");
                                                        } else if (op && opfill) {
                                                            opfill.style.backgroundColor = "var(--default-bbg-color)";
                                                            op.style.backgroundColor = "var(--default-fbg-color)";
                                                            //opText.textContent = el.result;
                                                        }
                                                    }
                                                });
                                                rindex++;
                                                progress = rindex;
                                                const percentage = (progress / maxprogress) * 100;
                                                progresses[currentProgressElement].style.width = `${percentage}%`;
                                                countDown(() => {
                                                    addQuestionAuto(rindex);
                                                });
                                            };
                                            div3.className = "optionTitle";
                                            div3.id = "optionTitle" + index;
                                            div3.textContent = op.text;
                                            //div2.textContent = op.percent;
                                            //div1.textContent = "option" + index;
                                            div1.appendChild(div2);
                                            div1.appendChild(div3);
                                            div1.style.pointerEvents = "none";
                                            setTimeout(() => {
                                                learnContent.appendChild(div1);
                                                if (index == alloptions.length - 1) {
                                                    skipBtn.style.display = skipdisplay;
                                                    backBtn.style.display = quitdisplay;
                                                    alloptions.forEach((el, index2) => {
                                                        const op = document.getElementById("optionBtn" + index2);
                                                        op.style.pointerEvents = "auto";
                                                    });
                                                }
                                            }, index * 100);
                                        });
                                })
                                .catch(error => {
                                    learnContent.innerHTML = "<p>questions not found.</p>";
                                    alert("questions not found.");
                                });
                        }
                    }
                    addQuestionAuto();
                })
                .catch(error => {
                    learnContent.innerHTML = "<p>Questions not found.</p>" + error;
                    alert("Questions not found.");
                });
        }
        function startQuestions(file) {
            startLoad();
            
            fetch("/questions/" + file)
                .then(response => {
                    if (!response.ok) throw new Error("Not found");
                    return response.json();
                })
                .then(data => {
                    stopLoad();
                    skipdisplay = "inline";
                    quitdisplay = "inline";
                    if (file === "math.json") {
                        chooseContent.style.display = "none";
                        learnContent.style.display = "block";
                        backBtn.style.display = quitdisplay;
                        addMathOptions(data, (level) => {
                            skipdisplay = "inline";
                            quitdisplay = "inline";
                            progressBarContainer.style.display = "flex";
                            progressBarContainer.style.animation = "none";
                            void progressBarContainer.offsetWidth;
                            progressBarContainer.style.animation = "progressBarAnimation 0.5s ease";
                            setTimeout(() => {
                                progressBarContainer.style.marginTop = "0";
                            }, 300);
                            addMathQuestions(data[level], level);
                        });
                    } else {
                        // Für alle anderen Dateien (kein "math.json"):
                        chooseContent.style.display = "none";
                        learnContent.style.display = "block";
                        progressBarContainer.style.display = "flex";
                        progressBarContainer.style.animation = "none";
                        void progressBarContainer.offsetWidth;
                        progressBarContainer.style.animation = "progressBarAnimation 0.5s ease";
                        setTimeout(() => {
                            progressBarContainer.style.marginTop = "0";
                        }, 300);
                        
                        const shuffled = shuffleArray(cutArray(data));
                        function addQuestionAuto(rindex = -0) {
                            addQuestion(shuffled, (ind) => {
                                addQuestionAuto(ind);
                            }, rindex);
                        }
                        addQuestionAuto();
                    }
                })
                .catch(error => {
                    learnContent.innerHTML = "<p>questions not found.</p>";
                    alert("questions not found.");
                });
        }
        function stopQuestions() {
            continueLoop = false;
            skipdisplay = "none";
            quitdisplay = "none";
            skipBtn.style.display = "none";
            timerContainer.style.display = "none";
            currentProgressElement = 0;
            progress = 0;
            backBtn.style.display = "none";
            skipBtn.style.display = "none";
            chooseContent.style.display = "block";
            learnContent.style.display = "none";
            progressBarContainer.style.animation = "none";
            void progressBarContainer.offsetWidth;
            progressBarContainer.style.animation = "progressBarAnimationOut 0.5s ease";
            
            progress1.style.width = "0";
            progress2.style.width = "0";
            progress3.style.width = "0";
            progress4.style.width = "0";
            
            
            setTimeout(() => {
                progressBarContainer.style.marginTop = "-100px";
                progressBarContainer.style.display = "none";
            }, 300);
        }
        
        backBtn.onclick = () => {
            stopQuestions();
        };
        
        function addChooseOp(text, file, img) {
            const button = document.createElement('button');
            button.textContent = text;
            button.style.backgroundImage = `url(${img})`;
            button.onclick = () => {
                startQuestions(file);
            };
            chooseContent.appendChild(button);
        }
        
        function fetchQuestions(file) {
            startLoad();
            fetch(file)
              .then(response => {
                  if (response.ok) {
                      return response.json();
                  }
              })
              .then(data => {
                  stopLoad();
                  chooseContent.innerHTML = "<p>choose an Exercise</p>";
                  data.forEach(question => {
                    addChooseOp(question.text, question.file, question.img);
                });
              })
              .catch(error => {
                    learnContent.innerHTML = "<p>Exercises not found.</p>";
                    alert("Exercises not found.");
                });
        }
        fetchQuestions("/questions/questions.json");
    </script>
</body>
</html>
